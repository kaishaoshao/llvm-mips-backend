<!DOCTYPE html><html lang="en" dir="ltr" data-theme="dark" data-has-toc data-has-sidebar class="astro-bguv2lll"> <head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>Adding Registers | LLVM to MIPS</title><link rel="canonical"/><link rel="shortcut icon" href="/favicon.svg" type="image/svg+xml"/><meta name="generator" content="Astro v5.2.6"/><meta name="generator" content="Starlight v0.31.1"/><meta property="og:title" content="Adding Registers"/><meta property="og:type" content="article"/><meta property="og:url"/><meta property="og:locale" content="en"/><meta property="og:description" content="Adding registers for the Nova architecture."/><meta property="og:site_name" content="LLVM to MIPS"/><meta name="twitter:card" content="summary_large_image"/><meta name="description" content="Adding registers for the Nova architecture."/><script>
	window.StarlightThemeProvider = (() => {
		const storedTheme =
			typeof localStorage !== 'undefined' && localStorage.getItem('starlight-theme');
		const theme =
			storedTheme ||
			(window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark');
		document.documentElement.dataset.theme = theme === 'light' ? 'light' : 'dark';
		return {
			updatePickers(theme = storedTheme || 'auto') {
				document.querySelectorAll('starlight-theme-select').forEach((picker) => {
					const select = picker.querySelector('select');
					if (select) select.value = theme;
					/** @type {HTMLTemplateElement | null} */
					const tmpl = document.querySelector(`#theme-icons`);
					const newIcon = tmpl && tmpl.content.querySelector('.' + theme);
					if (newIcon) {
						const oldIcon = picker.querySelector('svg.label-icon');
						if (oldIcon) {
							oldIcon.replaceChildren(...newIcon.cloneNode(true).childNodes);
						}
					}
				});
			},
		};
	})();
</script><template id="theme-icons"><svg aria-hidden="true" class="light astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M5 12a1 1 0 0 0-1-1H3a1 1 0 0 0 0 2h1a1 1 0 0 0 1-1Zm.64 5-.71.71a1 1 0 0 0 0 1.41 1 1 0 0 0 1.41 0l.71-.71A1 1 0 0 0 5.64 17ZM12 5a1 1 0 0 0 1-1V3a1 1 0 0 0-2 0v1a1 1 0 0 0 1 1Zm5.66 2.34a1 1 0 0 0 .7-.29l.71-.71a1 1 0 1 0-1.41-1.41l-.66.71a1 1 0 0 0 0 1.41 1 1 0 0 0 .66.29Zm-12-.29a1 1 0 0 0 1.41 0 1 1 0 0 0 0-1.41l-.71-.71a1.004 1.004 0 1 0-1.43 1.41l.73.71ZM21 11h-1a1 1 0 0 0 0 2h1a1 1 0 0 0 0-2Zm-2.64 6A1 1 0 0 0 17 18.36l.71.71a1 1 0 0 0 1.41 0 1 1 0 0 0 0-1.41l-.76-.66ZM12 6.5a5.5 5.5 0 1 0 5.5 5.5A5.51 5.51 0 0 0 12 6.5Zm0 9a3.5 3.5 0 1 1 0-7 3.5 3.5 0 0 1 0 7Zm0 3.5a1 1 0 0 0-1 1v1a1 1 0 0 0 2 0v-1a1 1 0 0 0-1-1Z"/></svg> <svg aria-hidden="true" class="dark astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21.64 13a1 1 0 0 0-1.05-.14 8.049 8.049 0 0 1-3.37.73 8.15 8.15 0 0 1-8.14-8.1 8.59 8.59 0 0 1 .25-2A1 1 0 0 0 8 2.36a10.14 10.14 0 1 0 14 11.69 1 1 0 0 0-.36-1.05Zm-9.5 6.69A8.14 8.14 0 0 1 7.08 5.22v.27a10.15 10.15 0 0 0 10.14 10.14 9.784 9.784 0 0 0 2.1-.22 8.11 8.11 0 0 1-7.18 4.32v-.04Z"/></svg> <svg aria-hidden="true" class="auto astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21 14h-1V7a3 3 0 0 0-3-3H7a3 3 0 0 0-3 3v7H3a1 1 0 0 0-1 1v2a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-2a1 1 0 0 0-1-1ZM6 7a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v7H6V7Zm14 10a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-1h16v1Z"/></svg> </template><link rel="stylesheet" href="/_astro/print.BJ0teN4y.css" media="print"><link rel="stylesheet" href="/_astro/index.BdVUmuzS.css">
<style>:root{--sl-badge-default-border: var(--sl-color-accent);--sl-badge-default-bg: var(--sl-color-accent-low);--sl-badge-default-text: #fff;--sl-badge-note-border: var(--sl-color-blue);--sl-badge-note-bg: var(--sl-color-blue-low);--sl-badge-note-text: #fff;--sl-badge-danger-border: var(--sl-color-red);--sl-badge-danger-bg: var(--sl-color-red-low);--sl-badge-danger-text: #fff;--sl-badge-success-border: var(--sl-color-green);--sl-badge-success-bg: var(--sl-color-green-low);--sl-badge-success-text: #fff;--sl-badge-caution-border: var(--sl-color-orange);--sl-badge-caution-bg: var(--sl-color-orange-low);--sl-badge-caution-text: #fff;--sl-badge-tip-border: var(--sl-color-purple);--sl-badge-tip-bg: var(--sl-color-purple-low);--sl-badge-tip-text: #fff}[data-theme=light]:root{--sl-badge-default-bg: var(--sl-color-accent-high);--sl-badge-note-bg: var(--sl-color-blue-high);--sl-badge-danger-bg: var(--sl-color-red-high);--sl-badge-success-bg: var(--sl-color-green-high);--sl-badge-caution-bg: var(--sl-color-orange-high);--sl-badge-tip-bg: var(--sl-color-purple-high)}.sl-badge:where(.astro-avdet4wd){display:inline-block;border:1px solid var(--sl-color-border-badge);border-radius:.25rem;font-family:var(--sl-font-system-mono);line-height:normal;color:var(--sl-color-text-badge);background-color:var(--sl-color-bg-badge);overflow-wrap:anywhere}.sidebar-content .sl-badge:where(.astro-avdet4wd){line-height:1;font-size:var(--sl-text-xs);padding:.125rem .375rem}.sidebar-content a[aria-current=page]>.sl-badge:where(.astro-avdet4wd){--sl-color-bg-badge: transparent;--sl-color-border-badge: currentColor;color:inherit}.default:where(.astro-avdet4wd){--sl-color-bg-badge: var(--sl-badge-default-bg);--sl-color-border-badge: var(--sl-badge-default-border);--sl-color-text-badge: var(--sl-badge-default-text)}.note:where(.astro-avdet4wd){--sl-color-bg-badge: var(--sl-badge-note-bg);--sl-color-border-badge: var(--sl-badge-note-border);--sl-color-text-badge: var(--sl-badge-note-text)}.danger:where(.astro-avdet4wd){--sl-color-bg-badge: var(--sl-badge-danger-bg);--sl-color-border-badge: var(--sl-badge-danger-border);--sl-color-text-badge: var(--sl-badge-danger-text)}.success:where(.astro-avdet4wd){--sl-color-bg-badge: var(--sl-badge-success-bg);--sl-color-border-badge: var(--sl-badge-success-border);--sl-color-text-badge: var(--sl-badge-success-text)}.tip:where(.astro-avdet4wd){--sl-color-bg-badge: var(--sl-badge-tip-bg);--sl-color-border-badge: var(--sl-badge-tip-border);--sl-color-text-badge: var(--sl-badge-tip-text)}.caution:where(.astro-avdet4wd){--sl-color-bg-badge: var(--sl-badge-caution-bg);--sl-color-border-badge: var(--sl-badge-caution-border);--sl-color-text-badge: var(--sl-badge-caution-text)}.small:where(.astro-avdet4wd){font-size:var(--sl-text-xs);padding:.125rem .25rem}.medium:where(.astro-avdet4wd){font-size:var(--sl-text-sm);padding:.175rem .35rem}.large:where(.astro-avdet4wd){font-size:var(--sl-text-base);padding:.225rem .45rem}.sl-markdown-content :is(h1,h2,h3,h4,h5,h6) .sl-badge:where(.astro-avdet4wd){vertical-align:middle}
.card-grid:where(.astro-zntqmydn){display:grid;grid-template-columns:100%;gap:1rem}.card-grid:where(.astro-zntqmydn)>*{margin-top:0!important}@media (min-width: 50rem){.card-grid:where(.astro-zntqmydn){grid-template-columns:1fr 1fr;gap:1.5rem}.stagger:where(.astro-zntqmydn){--stagger-height: 5rem;padding-bottom:var(--stagger-height)}.stagger:where(.astro-zntqmydn)>*:nth-child(2n){transform:translateY(var(--stagger-height))}}
.card:where(.astro-v5tidmuc){--sl-card-border: var(--sl-color-purple);--sl-card-bg: var(--sl-color-purple-low);border:1px solid var(--sl-color-gray-5);background-color:var(--sl-color-black);padding:clamp(1rem,calc(.125rem + 3vw),2.5rem);flex-direction:column;gap:clamp(.5rem,calc(.125rem + 1vw),1rem)}.card:where(.astro-v5tidmuc):nth-child(4n+1){--sl-card-border: var(--sl-color-orange);--sl-card-bg: var(--sl-color-orange-low)}.card:where(.astro-v5tidmuc):nth-child(4n+3){--sl-card-border: var(--sl-color-green);--sl-card-bg: var(--sl-color-green-low)}.card:where(.astro-v5tidmuc):nth-child(4n+4){--sl-card-border: var(--sl-color-red);--sl-card-bg: var(--sl-color-red-low)}.card:where(.astro-v5tidmuc):nth-child(4n+5){--sl-card-border: var(--sl-color-blue);--sl-card-bg: var(--sl-color-blue-low)}.title:where(.astro-v5tidmuc){font-weight:600;font-size:var(--sl-text-h4);color:var(--sl-color-white);line-height:var(--sl-line-height-headings);gap:1rem;align-items:center}.card:where(.astro-v5tidmuc) .icon:where(.astro-v5tidmuc){border:1px solid var(--sl-card-border);background-color:var(--sl-card-bg);padding:.2em;border-radius:.25rem}.card:where(.astro-v5tidmuc) .body:where(.astro-v5tidmuc){margin:0;font-size:clamp(var(--sl-text-sm),calc(.5rem + 1vw),var(--sl-text-body))}
svg:where(.astro-c6vsoqas){color:var(--sl-icon-color);font-size:var(--sl-icon-size, 1em);width:1em;height:1em}
.sl-link-card:where(.astro-mf7fz2mj){display:grid;grid-template-columns:1fr auto;gap:.5rem;border:1px solid var(--sl-color-gray-5);border-radius:.5rem;padding:1rem;box-shadow:var(--sl-shadow-sm);position:relative}a:where(.astro-mf7fz2mj){text-decoration:none;line-height:var(--sl-line-height-headings)}a:where(.astro-mf7fz2mj):before{content:"";position:absolute;inset:0}.stack:where(.astro-mf7fz2mj){flex-direction:column;gap:.5rem}.title:where(.astro-mf7fz2mj){color:var(--sl-color-white);font-weight:600;font-size:var(--sl-text-lg)}.description:where(.astro-mf7fz2mj){color:var(--sl-color-gray-3);line-height:1.5}.icon:where(.astro-mf7fz2mj){color:var(--sl-color-gray-3)}.sl-link-card:where(.astro-mf7fz2mj):hover{background:var(--sl-color-gray-7, var(--sl-color-gray-6));border-color:var(--sl-color-gray-2)}.sl-link-card:where(.astro-mf7fz2mj):hover .icon:where(.astro-mf7fz2mj){color:var(--sl-color-white)}
.sl-steps{--bullet-size: calc(var(--sl-line-height) * 1rem);--bullet-margin: .375rem;list-style:none;counter-reset:steps-counter var(--sl-steps-start, 0);padding-inline-start:0}.sl-steps>li{counter-increment:steps-counter;position:relative;padding-inline-start:calc(var(--bullet-size) + 1rem);padding-bottom:1px;min-height:calc(var(--bullet-size) + var(--bullet-margin))}.sl-steps>li+li{margin-top:0}.sl-steps>li:before{content:counter(steps-counter);position:absolute;top:0;inset-inline-start:0;width:var(--bullet-size);height:var(--bullet-size);line-height:var(--bullet-size);font-size:var(--sl-text-xs);font-weight:600;text-align:center;color:var(--sl-color-white);background-color:var(--sl-color-gray-6);border-radius:99rem;box-shadow:inset 0 0 0 1px var(--sl-color-gray-5)}.sl-steps>li:after{--guide-width: 1px;content:"";position:absolute;top:calc(var(--bullet-size) + var(--bullet-margin));bottom:var(--bullet-margin);inset-inline-start:calc((var(--bullet-size) - var(--guide-width)) / 2);width:var(--guide-width);background-color:var(--sl-color-hairline-light)}.sl-steps>li>:first-child{--lh: calc(1em * var(--sl-line-height));--shift-y: calc(.5 * (var(--bullet-size) - var(--lh)));transform:translateY(var(--shift-y));margin-bottom:var(--shift-y)}.sl-steps>li>:first-child:where(h1,h2,h3,h4,h5,h6){--lh: calc(1em * var(--sl-line-height-headings))}@supports (--prop: 1lh){.sl-steps>li>:first-child{--lh: 1lh}}
.sl-link-button:where(.astro-xwgiixxa){align-items:center;border:1px solid transparent;border-radius:999rem;display:inline-flex;font-size:var(--sl-text-sm);gap:.5em;line-height:1.1875;outline-offset:.25rem;padding:.4375rem 1.125rem;text-decoration:none}.sl-link-button:where(.astro-xwgiixxa).primary{background:var(--sl-color-text-accent);border-color:var(--sl-color-text-accent);color:var(--sl-color-black)}.sl-link-button:where(.astro-xwgiixxa).primary:hover{color:var(--sl-color-black)}.sl-link-button:where(.astro-xwgiixxa).secondary{border-color:inherit;color:var(--sl-color-white)}.sl-link-button:where(.astro-xwgiixxa).minimal{color:var(--sl-color-white);padding-inline:0}.sl-link-button:where(.astro-xwgiixxa) svg{flex-shrink:0}@media (min-width: 50rem){.sl-link-button:where(.astro-xwgiixxa){font-size:var(--sl-text-base);padding:.9375rem 1.25rem}}.sl-markdown-content .sl-link-button:where(.astro-xwgiixxa){margin-inline-end:1rem}.sl-markdown-content .sl-link-button:where(.astro-xwgiixxa):not(:where(p *)){margin-block:1rem}
</style><script type="module" src="/_astro/page.7qqag-5g.js"></script><style>.code-snippet:where(.astro-xvlhowr4){display:flex;flex-direction:column;gap:0rem;*{margin:0!important}.context,.after-context{background-color:var(--sl-color-gray-6);padding:calc(var(--ec-uiPadBlk) + var(--ec-frm-edActTabIndHt)) var(--ec-uiPadInl);padding-left:calc(var(--ec-uiPadInl) - .6rem);font-family:var(--ec-codeFontFml);font-style:italic;font-size:calc(.97 * var(--ec-codeFontSize));white-space:pre-wrap;text-align:left}.after-context{display:flex;flex-direction:row;justify-content:space-between;align-items:center}@media screen and (max-width: 600px){.context{display:none}}}
</style><style>details:where(.astro-hbmamkfo).details{border:1px solid;border-radius:.5rem;margin-bottom:1rem;transition:background-color .2s ease}.details--note:where(.astro-hbmamkfo){background-color:#1e293b;border-color:#334155!important;color:#93c5fd}.details--tip:where(.astro-hbmamkfo){background-color:#14432a;border-color:#166534!important;color:#86efac}.details--warning:where(.astro-hbmamkfo){background-color:#422006;border-color:#854d0e!important;color:#fde047}.details--danger:where(.astro-hbmamkfo){background-color:#450a0a;border-color:#991b1b!important;color:#fca5a5}:root[data-theme=light] .details--note:where(.astro-hbmamkfo){background-color:#f0f7ff;border-color:#bfdbfe;color:#1e40af}:root[data-theme=light] .details--tip:where(.astro-hbmamkfo){background-color:#f0fdf4;border-color:#bbf7d0;color:#166534}:root[data-theme=light] .details--warning:where(.astro-hbmamkfo){background-color:#fefce8;border-color:#fef08a;color:#854d0e}:root[data-theme=light] .details--danger:where(.astro-hbmamkfo){background-color:#fef2f2;border-color:#fecaca;color:#991b1b}summary:where(.astro-hbmamkfo).details-summary{display:flex;flex-direction:row;align-items:center;gap:.5rem;margin:0!important;padding:.6rem .75rem;padding-left:0;cursor:pointer}.title:where(.astro-hbmamkfo){font-weight:500}.arrow:where(.astro-hbmamkfo){margin-left:auto}.details:where(.astro-hbmamkfo)[open] .arrow:where(.astro-hbmamkfo) svg:where(.astro-hbmamkfo){transform:rotate(180deg)}.arrow:where(.astro-hbmamkfo) svg:where(.astro-hbmamkfo){transition:transform .2s ease}.icon:where(.astro-hbmamkfo){display:flex;align-items:center}summary:where(.astro-hbmamkfo)::-webkit-details-marker{display:none}.content:where(.astro-hbmamkfo){overflow:hidden;transition:height .3s ease-out;padding:0 .75rem .75rem 0;margin-top:0!important;border-color:inherit}
</style></head> <body class="astro-bguv2lll"> <a href="#_top" class="astro-7q3lir66">Skip to content</a>  <div class="page sl-flex astro-vrdttmbt"> <header class="header astro-vrdttmbt"><div class="header sl-flex astro-kmkmnagf"> <div class="title-wrapper sl-flex astro-kmkmnagf"> <a href="/" class="site-title sl-flex astro-m46x6ez3">  <span class="astro-m46x6ez3" translate="no"> LLVM to MIPS </span> </a>  </div> <div class="sl-flex print:hidden astro-kmkmnagf"> <site-search class="astro-kmkmnagf astro-v37mnknz" data-translations="{&#34;placeholder&#34;:&#34;Search&#34;}"> <button data-open-modal disabled aria-label="Search" aria-keyshortcuts="Control+K" class="astro-v37mnknz"> <svg aria-hidden="true" class="astro-v37mnknz astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21.71 20.29 18 16.61A9 9 0 1 0 16.61 18l3.68 3.68a.999.999 0 0 0 1.42 0 1 1 0 0 0 0-1.39ZM11 18a7 7 0 1 1 0-14 7 7 0 0 1 0 14Z"/></svg>  <span class="sl-hidden md:sl-block astro-v37mnknz" aria-hidden="true">Search</span> <kbd class="sl-hidden md:sl-flex astro-v37mnknz" style="display: none;"> <kbd class="astro-v37mnknz">Ctrl</kbd><kbd class="astro-v37mnknz">K</kbd> </kbd> </button> <dialog style="padding:0" aria-label="Search" class="astro-v37mnknz"> <div class="dialog-frame sl-flex astro-v37mnknz">  <button data-close-modal class="sl-flex md:sl-hidden astro-v37mnknz"> Cancel </button> <div class="search-container astro-v37mnknz"> <div id="starlight__search" class="astro-v37mnknz"></div> </div> </div> </dialog> </site-search>  <script>
	(() => {
		const openBtn = document.querySelector('button[data-open-modal]');
		const shortcut = openBtn?.querySelector('kbd');
		if (!openBtn || !(shortcut instanceof HTMLElement)) return;
		const platformKey = shortcut.querySelector('kbd');
		if (platformKey && /(Mac|iPhone|iPod|iPad)/i.test(navigator.platform)) {
			platformKey.textContent = 'âŒ˜';
			openBtn.setAttribute('aria-keyshortcuts', 'Meta+K');
		}
		shortcut.style.display = '';
	})();
</script> <script type="module" src="/_astro/Search.astro_astro_type_script_index_0_lang.18-vQxR-.js"></script>   </div> <div class="sl-hidden md:sl-flex print:hidden right-group astro-kmkmnagf"> <div class="sl-flex social-icons astro-kmkmnagf"> <a href="https://github.com/optimisan/llvm-mips-backend" rel="me" class="sl-flex astro-wy4te6ga"><span class="sr-only astro-wy4te6ga">GitHub</span><svg aria-hidden="true" class="astro-wy4te6ga astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M12 .3a12 12 0 0 0-3.8 23.38c.6.12.83-.26.83-.57L9 21.07c-3.34.72-4.04-1.61-4.04-1.61-.55-1.39-1.34-1.76-1.34-1.76-1.08-.74.09-.73.09-.73 1.2.09 1.83 1.24 1.83 1.24 1.08 1.83 2.81 1.3 3.5 1 .1-.78.42-1.31.76-1.61-2.67-.3-5.47-1.33-5.47-5.93 0-1.31.47-2.38 1.24-3.22-.14-.3-.54-1.52.1-3.18 0 0 1-.32 3.3 1.23a11.5 11.5 0 0 1 6 0c2.28-1.55 3.29-1.23 3.29-1.23.64 1.66.24 2.88.12 3.18a4.65 4.65 0 0 1 1.23 3.22c0 4.61-2.8 5.63-5.48 5.92.42.36.81 1.1.81 2.22l-.01 3.29c0 .31.2.69.82.57A12 12 0 0 0 12 .3Z"/></svg> </a> </div> <starlight-theme-select>  <label style="--sl-select-width: 6.25em" class="astro-4yphtoen"> <span class="sr-only astro-4yphtoen">Select theme</span> <svg aria-hidden="true" class="icon label-icon astro-4yphtoen astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21 14h-1V7a3 3 0 0 0-3-3H7a3 3 0 0 0-3 3v7H3a1 1 0 0 0-1 1v2a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-2a1 1 0 0 0-1-1ZM6 7a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v7H6V7Zm14 10a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-1h16v1Z"/></svg>  <select value="auto" autocomplete="off" class="astro-4yphtoen"> <option value="dark" class="astro-4yphtoen">Dark</option><option value="light" class="astro-4yphtoen">Light</option><option value="auto" selected class="astro-4yphtoen">Auto</option> </select> <svg aria-hidden="true" class="icon caret astro-4yphtoen astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M17 9.17a1 1 0 0 0-1.41 0L12 12.71 8.46 9.17a1 1 0 1 0-1.41 1.42l4.24 4.24a1.002 1.002 0 0 0 1.42 0L17 10.59a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </label>  </starlight-theme-select>  <script>
	StarlightThemeProvider.updatePickers();
</script> <script type="module">const r="starlight-theme",o=e=>e==="auto"||e==="dark"||e==="light"?e:"auto",c=()=>o(typeof localStorage<"u"&&localStorage.getItem(r));function n(e){typeof localStorage<"u"&&localStorage.setItem(r,e==="light"||e==="dark"?e:"")}const l=()=>matchMedia("(prefers-color-scheme: light)").matches?"light":"dark";function t(e){StarlightThemeProvider.updatePickers(e),document.documentElement.dataset.theme=e==="auto"?l():e,n(e)}matchMedia("(prefers-color-scheme: light)").addEventListener("change",()=>{c()==="auto"&&t("auto")});class s extends HTMLElement{constructor(){super(),t(c()),this.querySelector("select")?.addEventListener("change",a=>{a.currentTarget instanceof HTMLSelectElement&&t(o(a.currentTarget.value))})}}customElements.define("starlight-theme-select",s);</script> <script type="module">class s extends HTMLElement{constructor(){super();const e=this.querySelector("select");e&&(e.addEventListener("change",t=>{t.currentTarget instanceof HTMLSelectElement&&(window.location.pathname=t.currentTarget.value)}),window.addEventListener("pageshow",t=>{if(!t.persisted)return;const n=e.querySelector("option[selected]")?.index;n!==e.selectedIndex&&(e.selectedIndex=n??0)}))}}customElements.define("starlight-lang-select",s);</script> </div> </div> </header> <nav class="sidebar print:hidden astro-vrdttmbt" aria-label="Main"> <starlight-menu-button class="print:hidden astro-jif73yzw"> <button aria-expanded="false" aria-label="Menu" aria-controls="starlight__sidebar" class="sl-flex md:sl-hidden astro-jif73yzw"> <svg aria-hidden="true" class="astro-jif73yzw astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M3 8h18a1 1 0 1 0 0-2H3a1 1 0 0 0 0 2Zm18 8H3a1 1 0 0 0 0 2h18a1 1 0 0 0 0-2Zm0-5H3a1 1 0 0 0 0 2h18a1 1 0 0 0 0-2Z"/></svg>  </button> </starlight-menu-button> <script type="module">class s extends HTMLElement{constructor(){super(),this.btn=this.querySelector("button"),this.btn.addEventListener("click",()=>this.toggleExpanded());const t=this.closest("nav");t&&t.addEventListener("keyup",e=>this.closeOnEscape(e))}setExpanded(t){this.setAttribute("aria-expanded",String(t)),document.body.toggleAttribute("data-mobile-menu-expanded",t)}toggleExpanded(){this.setExpanded(this.getAttribute("aria-expanded")!=="true")}closeOnEscape(t){t.code==="Escape"&&(this.setExpanded(!1),this.btn.focus())}}customElements.define("starlight-menu-button",s);</script>   <div id="starlight__sidebar" class="sidebar-pane astro-vrdttmbt"> <div class="sidebar-content sl-flex astro-vrdttmbt"> <sl-sidebar-state-persist data-hash="0kiw0rl" class="astro-kku4brbg"> <script aria-hidden="true">
		(() => {
			try {
				if (!matchMedia('(min-width: 50em)').matches) return;
				/** @type {HTMLElement | null} */
				const target = document.querySelector('sl-sidebar-state-persist');
				const state = JSON.parse(sessionStorage.getItem('sl-sidebar-state') || '0');
				if (!target || !state || target.dataset.hash !== state.hash) return;
				window._starlightScrollRestore = state.scroll;
				customElements.define(
					'sl-sidebar-restore',
					class SidebarRestore extends HTMLElement {
						connectedCallback() {
							try {
								const idx = parseInt(this.dataset.index || '');
								const details = this.closest('details');
								if (details && typeof state.open[idx] === 'boolean') details.open = state.open[idx];
							} catch {}
						}
					}
				);
			} catch {}
		})();
	</script>  <ul class="top-level astro-3ii7xxms"> <li class="astro-3ii7xxms"> <details open class="astro-3ii7xxms"> <sl-sidebar-restore data-index="0"></sl-sidebar-restore> <summary class="astro-3ii7xxms"> <div class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">Background</span>  </div> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </summary> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/background/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">About this book</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/background/02-mips-architecture/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">The MipsNova Architecture</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/background/03-about-llvm/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">About LLVM</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/background/04-getting-started/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Getting Started</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/background/01-motivation/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Motivation for this project</span>  </a> </li> </ul>  </details> </li><li class="astro-3ii7xxms"> <details open class="astro-3ii7xxms"> <sl-sidebar-restore data-index="1"></sl-sidebar-restore> <summary class="astro-3ii7xxms"> <div class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">Section 1</span>  </div> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </summary> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/section-1/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Section 1: Registering the target</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/section-1/01-triple/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">The Target Triple</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/section-1/02-registers/" aria-current="page" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Adding Registers</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/section-1/03-instructions/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Adding instructions</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/section-1/testing/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">The testing part</span>  </a> </li> </ul>  </details> </li><li class="astro-3ii7xxms"> <details open class="astro-3ii7xxms"> <sl-sidebar-restore data-index="2"></sl-sidebar-restore> <summary class="astro-3ii7xxms"> <div class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">Reference</span>  </div> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </summary> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/reference/example/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">LLVM backend resources</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/reference/mips-isa/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">MIPS 32 Architecture</span>  </a> </li> </ul>  </details> </li><li class="astro-3ii7xxms"> <details open class="astro-3ii7xxms"> <sl-sidebar-restore data-index="3"></sl-sidebar-restore> <summary class="astro-3ii7xxms"> <div class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">2. MIPS Architecture</span>  </div> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </summary> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/mips-arch/introduction/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">MIPS Architecture</span>  </a> </li> </ul>  </details> </li> </ul>   <script aria-hidden="true">
		(() => {
			const scroller = document.getElementById('starlight__sidebar');
			if (!window._starlightScrollRestore || !scroller) return;
			scroller.scrollTop = window._starlightScrollRestore;
			delete window._starlightScrollRestore;
		})();
	</script> </sl-sidebar-state-persist>  <div class="md:sl-hidden"> <div class="mobile-preferences sl-flex astro-wu23bvmt"> <div class="sl-flex social-icons astro-wu23bvmt"> <a href="https://github.com/optimisan/llvm-mips-backend" rel="me" class="sl-flex astro-wy4te6ga"><span class="sr-only astro-wy4te6ga">GitHub</span><svg aria-hidden="true" class="astro-wy4te6ga astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M12 .3a12 12 0 0 0-3.8 23.38c.6.12.83-.26.83-.57L9 21.07c-3.34.72-4.04-1.61-4.04-1.61-.55-1.39-1.34-1.76-1.34-1.76-1.08-.74.09-.73.09-.73 1.2.09 1.83 1.24 1.83 1.24 1.08 1.83 2.81 1.3 3.5 1 .1-.78.42-1.31.76-1.61-2.67-.3-5.47-1.33-5.47-5.93 0-1.31.47-2.38 1.24-3.22-.14-.3-.54-1.52.1-3.18 0 0 1-.32 3.3 1.23a11.5 11.5 0 0 1 6 0c2.28-1.55 3.29-1.23 3.29-1.23.64 1.66.24 2.88.12 3.18a4.65 4.65 0 0 1 1.23 3.22c0 4.61-2.8 5.63-5.48 5.92.42.36.81 1.1.81 2.22l-.01 3.29c0 .31.2.69.82.57A12 12 0 0 0 12 .3Z"/></svg> </a> </div> <starlight-theme-select>  <label style="--sl-select-width: 6.25em" class="astro-4yphtoen"> <span class="sr-only astro-4yphtoen">Select theme</span> <svg aria-hidden="true" class="icon label-icon astro-4yphtoen astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21 14h-1V7a3 3 0 0 0-3-3H7a3 3 0 0 0-3 3v7H3a1 1 0 0 0-1 1v2a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-2a1 1 0 0 0-1-1ZM6 7a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v7H6V7Zm14 10a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-1h16v1Z"/></svg>  <select value="auto" autocomplete="off" class="astro-4yphtoen"> <option value="dark" class="astro-4yphtoen">Dark</option><option value="light" class="astro-4yphtoen">Light</option><option value="auto" selected class="astro-4yphtoen">Auto</option> </select> <svg aria-hidden="true" class="icon caret astro-4yphtoen astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M17 9.17a1 1 0 0 0-1.41 0L12 12.71 8.46 9.17a1 1 0 1 0-1.41 1.42l4.24 4.24a1.002 1.002 0 0 0 1.42 0L17 10.59a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </label>  </starlight-theme-select>  <script>
	StarlightThemeProvider.updatePickers();
</script>   </div>  </div> </div> </div> </nav> <div class="main-frame astro-vrdttmbt">  <script type="module">const a=document.getElementById("starlight__sidebar"),n=a?.querySelector("sl-sidebar-state-persist"),o="sl-sidebar-state",i=()=>{let t=[];const e=n?.dataset.hash||"";try{const s=sessionStorage.getItem(o),r=JSON.parse(s||"{}");Array.isArray(r.open)&&r.hash===e&&(t=r.open)}catch{}return{hash:e,open:t,scroll:a?.scrollTop||0}},c=t=>{try{sessionStorage.setItem(o,JSON.stringify(t))}catch{}},d=()=>c(i()),l=(t,e)=>{const s=i();s.open[e]=t,c(s)};n?.addEventListener("click",t=>{if(!(t.target instanceof Element))return;const e=t.target.closest("summary")?.closest("details");if(!e)return;const s=e.querySelector("sl-sidebar-restore"),r=parseInt(s?.dataset.index||"");isNaN(r)||l(!e.open,r)});addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&d()});addEventListener("pageHide",d);</script> <div class="lg:sl-flex astro-67yu43on"> <aside class="right-sidebar-container print:hidden astro-67yu43on"> <div class="right-sidebar astro-67yu43on"> <div class="lg:sl-hidden astro-pb3aqygn"><mobile-starlight-toc data-min-h="2" data-max-h="3" class="astro-doynk5tl"><nav aria-labelledby="starlight__on-this-page--mobile" class="astro-doynk5tl"><details id="starlight__mobile-toc" class="astro-doynk5tl"><summary id="starlight__on-this-page--mobile" class="sl-flex astro-doynk5tl"><div class="toggle sl-flex astro-doynk5tl">On this page<svg aria-hidden="true" class="caret astro-doynk5tl astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </div><span class="display-current astro-doynk5tl"></span></summary><div class="dropdown astro-doynk5tl"><ul class="isMobile astro-g2bywc46" style="--depth: 0;"> <li class="astro-g2bywc46" style="--depth: 0;"> <a href="#_top" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Overview</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#registers" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Registers</span> </a> <ul class="isMobile astro-g2bywc46" style="--depth: 1;"> <li class="astro-g2bywc46" style="--depth: 1;"> <a href="#the-register-class" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">The Register class</span> </a>  </li> </ul>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#register-classes-rc" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Register classes (RC)</span> </a> <ul class="isMobile astro-g2bywc46" style="--depth: 1;"> <li class="astro-g2bywc46" style="--depth: 1;"> <a href="#other-register-classes" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Other Register classes</span> </a>  </li> </ul>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#generating-the-inc-file" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Generating the .inc file</span> </a> <ul class="isMobile astro-g2bywc46" style="--depth: 1;"> <li class="astro-g2bywc46" style="--depth: 1;"> <a href="#tablegen-output" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">TableGen output</span> </a>  </li> </ul>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#llvm-classes" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">LLVM Classes</span> </a> <ul class="isMobile astro-g2bywc46" style="--depth: 1;"> <li class="astro-g2bywc46" style="--depth: 1;"> <a href="#representing-registers" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Representing Registers</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#mcregisterinfo" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">MCRegisterInfo</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#the-generated-file" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">The generated file</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#add-to-cmake" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Add to cmake</span> </a>  </li> </ul>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#adding-the-novaregisterinfo-class" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Adding the NovaRegisterInfo class</span> </a>  </li> </ul> </div></details></nav></mobile-starlight-toc><script type="module" src="/_astro/MobileTableOfContents.astro_astro_type_script_index_0_lang.C181hMzK.js"></script></div><div class="right-sidebar-panel sl-hidden lg:sl-block astro-pb3aqygn"><div class="sl-container astro-pb3aqygn"><starlight-toc data-min-h="2" data-max-h="3"><nav aria-labelledby="starlight__on-this-page"><h2 id="starlight__on-this-page">On this page</h2><ul class="astro-g2bywc46" style="--depth: 0;"> <li class="astro-g2bywc46" style="--depth: 0;"> <a href="#_top" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Overview</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#registers" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Registers</span> </a> <ul class="astro-g2bywc46" style="--depth: 1;"> <li class="astro-g2bywc46" style="--depth: 1;"> <a href="#the-register-class" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">The Register class</span> </a>  </li> </ul>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#register-classes-rc" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Register classes (RC)</span> </a> <ul class="astro-g2bywc46" style="--depth: 1;"> <li class="astro-g2bywc46" style="--depth: 1;"> <a href="#other-register-classes" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Other Register classes</span> </a>  </li> </ul>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#generating-the-inc-file" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Generating the .inc file</span> </a> <ul class="astro-g2bywc46" style="--depth: 1;"> <li class="astro-g2bywc46" style="--depth: 1;"> <a href="#tablegen-output" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">TableGen output</span> </a>  </li> </ul>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#llvm-classes" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">LLVM Classes</span> </a> <ul class="astro-g2bywc46" style="--depth: 1;"> <li class="astro-g2bywc46" style="--depth: 1;"> <a href="#representing-registers" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Representing Registers</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#mcregisterinfo" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">MCRegisterInfo</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#the-generated-file" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">The generated file</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#add-to-cmake" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Add to cmake</span> </a>  </li> </ul>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#adding-the-novaregisterinfo-class" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Adding the NovaRegisterInfo class</span> </a>  </li> </ul> </nav></starlight-toc><script type="module" src="/_astro/TableOfContents.astro_astro_type_script_index_0_lang.CKWWgpjV.js"></script></div></div> </div> </aside> <div class="main-pane astro-67yu43on">  <main data-pagefind-body class="astro-bguv2lll" lang="en" dir="ltr">    <div class="content-panel astro-7nkwcw3z"> <div class="sl-container astro-7nkwcw3z"> <h1 id="_top" class="astro-j6tvhyss">Adding Registers</h1>  </div> </div>  <div class="content-panel astro-7nkwcw3z"> <div class="sl-container astro-7nkwcw3z"> <div class="sl-markdown-content"> <p>We now have our triple registered with <code dir="auto">llc</code>. To compile a program, we need
to add our target details so that <code dir="auto">llc</code> knows how to generate code.</p>
<p>This chapter will add registers to the Nova backend.</p>
<div class="sl-link-card astro-mf7fz2mj"> <span class="sl-flex stack astro-mf7fz2mj"> <a href="https://www.cs.unibo.it/~solmi/teaching/arch_2002-2003/AssemblyLanguageProgDoc.pdf" target="_blank" class="astro-mf7fz2mj"> <span class="title astro-mf7fz2mj">Reference for the MIPS architecture</span> </a>  </span> <svg aria-hidden="true" class="icon rtl:flip astro-mf7fz2mj astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.333em;"><path d="M17.92 11.62a1.001 1.001 0 0 0-.21-.33l-5-5a1.003 1.003 0 1 0-1.42 1.42l3.3 3.29H7a1 1 0 0 0 0 2h7.59l-3.3 3.29a1.002 1.002 0 0 0 .325 1.639 1 1 0 0 0 1.095-.219l5-5a1 1 0 0 0 .21-.33 1 1 0 0 0 0-.76Z"/></svg>  </div> 
<h2 id="registers">Registers</h2>
<p>The CPU has 32 registers (that are 32-bit). The general-purpose registers have the names <code dir="auto">$0</code> to <code dir="auto">$31</code> and also have aliases.</p>
<p>We add all these registers in the <code dir="auto">NovaRegisterInfo.td</code> file.</p>
<h3 id="the-register-class">The <code dir="auto">Register</code> class</h3>
<p>First, create the top level <code dir="auto">Nova.td</code> file. This pulls in all other
tablegen files.</p>
<div class="code-snippet astro-xvlhowr4"> <!-- for the after context div -->  <!-- for other contexts --> <div class="context astro-xvlhowr4"> <span class="astro-xvlhowr4">&gt;&gt; new file</span><br class="astro-xvlhowr4"></div> <div class="expressive-code astro-xvlhowr4"><link rel="stylesheet" href="/_astro/ec.678xb.css"><script type="module" src="/_astro/ec.8zarh.js"></script><figure class="frame has-title not-content"><figcaption class="header"><span class="title">llvm/lib/Target/Nova/Nova.td(create-nova-td)</span></figcaption><pre data-language="cpp" class="wrap" style="--ecMaxLine:57ch"><code><div class="ec-line highlight ins"><div class="code"><span style="--0:#80a86f;--1:#007000">// This is the top tablegen file that pulls in other code</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#80a86f;--1:#007000">// specific to the Nova target.</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#D4D4D4;--1:#000000">include </span><span style="--0:#CE9178;--1:#A31515">"llvm/Target/Target.td"</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#D4D4D4;--1:#000000">include </span><span style="--0:#CE9178;--1:#A31515">"NovaRegisterInfo.td"</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#D4D4D4;--1:#000000">include </span><span style="--0:#CE9178;--1:#A31515">"NovaInstrInfo.td"</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#D4D4D4;--1:#000000">def : ProcessorModel&#x3C;</span><span style="--0:#CE9178;--1:#A31515">"generic"</span><span style="--0:#D4D4D4;--1:#000000">, NoSchedModel, []>;</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#D4D4D4;--1:#000000">def NovaInstrInfo : InstrInfo {}</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#D4D4D4;--1:#000000">def Nova : Target {</span></div></div><div class="ec-line highlight ins" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#D4D4D4;--1:#000000">  </span></span><span style="--0:#D4D4D4;--1:#000000">let InstructionSet = NovaInstrInfo;</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#D4D4D4;--1:#000000">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="// This is the top tablegen file that pulls in other code// specific to the Nova target.include &#x22;llvm/Target/Target.td&#x22;include &#x22;NovaRegisterInfo.td&#x22;include &#x22;NovaInstrInfo.td&#x22;def : ProcessorModel<&#x22;generic&#x22;, NoSchedModel, []>;def NovaInstrInfo : InstrInfo {}def Nova : Target {  let InstructionSet = NovaInstrInfo;}"><div></div></button></div></figure></div> </div>
<p>We have to enumerate our registers as records of the class <code dir="auto">Register</code> defined in <code dir="auto">llvm/include/llvm/Target/Target.td</code>.</p>
<p>The fields of interest to us are:</p>
<ul>
<li><code dir="auto">string Namespace</code> - the target namespace (Nova in our case)</li>
<li><code dir="auto">string AsmName</code> - the assembly name of the register ($zero, $1 etc.)</li>
<li><code dir="auto">list&#x3C;string> AltNames</code> - aliases for the register</li>
<li><code dir="auto">list&#x3C;Register> SubRegs</code> - subregisters of the register</li>
<li><code dir="auto">bit isConstant</code> - whether the register holds a constant value</li>
</ul>
<div class="code-snippet astro-xvlhowr4"> <!-- for the after context div -->  <!-- for other contexts --> <div class="context astro-xvlhowr4"> <span class="astro-xvlhowr4">&gt;&gt; new file</span><br class="astro-xvlhowr4"></div> <div class="expressive-code astro-xvlhowr4"><figure class="frame has-title not-content"><figcaption class="header"><span class="title">llvm/lib/Target/Nova/NovaRegisterInfo.td(nova-registers)</span></figcaption><pre data-language="cpp" class="wrap" style="--ecMaxLine:42ch"><code><div class="ec-line highlight ins"><div class="code"><span style="--0:#80a86f;--1:#007000">// Nova CPU Registers</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#62a3d9;--1:#0000FF">class</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#4EC9B0;--1:#1f687d">NovaReg</span><span style="--0:#D4D4D4;--1:#000000">&#x3C;</span><span style="--0:#4EC9B0;--1:#1f687d">string</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#4EC9B0;--1:#1f687d">n</span><span style="--0:#D4D4D4;--1:#000000">> : </span><span style="--0:#4EC9B0;--1:#1f687d">Register</span><span style="--0:#D4D4D4;--1:#000000">&#x3C;</span><span style="--0:#4EC9B0;--1:#1f687d">n</span><span style="--0:#D4D4D4;--1:#000000">> {</span></div></div><div class="ec-line highlight ins" style="--ecIndent:4ch"><div class="code"><span class="indent"><span style="--0:#D4D4D4;--1:#000000">    </span></span><span style="--0:#D4D4D4;--1:#000000">let Namespace = </span><span style="--0:#CE9178;--1:#A31515">"Nova"</span><span style="--0:#D4D4D4;--1:#000000">;</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#D4D4D4;--1:#000000">}</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#62a3d9;--1:#0000FF">class</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#4EC9B0;--1:#1f687d">NovaGPRReg</span><span style="--0:#D4D4D4;--1:#000000">&#x3C;</span><span style="--0:#4EC9B0;--1:#1f687d">string</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#4EC9B0;--1:#1f687d">n</span><span style="--0:#D4D4D4;--1:#000000">> : </span><span style="--0:#4EC9B0;--1:#1f687d">Register</span><span style="--0:#D4D4D4;--1:#000000">&#x3C;</span><span style="--0:#4EC9B0;--1:#1f687d">n</span><span style="--0:#D4D4D4;--1:#000000">> {</span></div></div><div class="ec-line highlight ins" style="--ecIndent:4ch"><div class="code"><span class="indent"><span style="--0:#D4D4D4;--1:#000000">    </span></span><span style="--0:#D4D4D4;--1:#000000">let Namespace = </span><span style="--0:#CE9178;--1:#A31515">"Nova"</span><span style="--0:#D4D4D4;--1:#000000">;</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#D4D4D4;--1:#000000">}</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-section collapsible-start"><details><summary><div class="ec-line"><div class="code"><span class="expand"></span><span class="collapse"></span><span class="text">26 collapsed lines</span></div></div></summary></details><div class="content-lines"><div class="ec-line highlight ins"><div class="code"><span style="--0:#D4D4D4;--1:#000000">let Namespace = </span><span style="--0:#CE9178;--1:#A31515">"Nova"</span><span style="--0:#D4D4D4;--1:#000000"> in {</span></div></div><div class="ec-line highlight ins" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#D4D4D4;--1:#000000">  </span></span><span style="--0:#D4D4D4;--1:#000000">def </span><span style="--0:#C8C8C8;--1:#000000">ZERO</span><span style="--0:#D4D4D4;--1:#000000"> : NovaGPRReg&#x3C;</span><span style="--0:#CE9178;--1:#A31515">"zero"</span><span style="--0:#D4D4D4;--1:#000000">> {</span></div></div><div class="ec-line highlight ins" style="--ecIndent:4ch"><div class="code"><span class="indent"><span style="--0:#D4D4D4;--1:#000000">    </span></span><span style="--0:#D4D4D4;--1:#000000">let isConstant = </span><span style="--0:#B5CEA8;--1:#076e48">1</span><span style="--0:#D4D4D4;--1:#000000">;</span></div></div><div class="ec-line highlight ins" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#D4D4D4;--1:#000000">  </span></span><span style="--0:#D4D4D4;--1:#000000">}</span></div></div><div class="ec-line highlight ins" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#D4D4D4;--1:#000000">  </span></span><span style="--0:#D4D4D4;--1:#000000">def </span><span style="--0:#C8C8C8;--1:#000000">AT</span><span style="--0:#D4D4D4;--1:#000000">   : NovaGPRReg&#x3C;</span><span style="--0:#CE9178;--1:#A31515">"at"</span><span style="--0:#D4D4D4;--1:#000000">>;</span></div></div><div class="ec-line highlight ins" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#D4D4D4;--1:#000000">  </span></span><span style="--0:#D4D4D4;--1:#000000">def </span><span style="--0:#C8C8C8;--1:#000000">V0</span><span style="--0:#D4D4D4;--1:#000000">   : NovaGPRReg&#x3C;</span><span style="--0:#CE9178;--1:#A31515">"2"</span><span style="--0:#D4D4D4;--1:#000000">>;</span></div></div><div class="ec-line highlight ins" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#D4D4D4;--1:#000000">  </span></span><span style="--0:#D4D4D4;--1:#000000">def </span><span style="--0:#C8C8C8;--1:#000000">V1</span><span style="--0:#D4D4D4;--1:#000000">   : NovaGPRReg&#x3C;</span><span style="--0:#CE9178;--1:#A31515">"3"</span><span style="--0:#D4D4D4;--1:#000000">>;</span></div></div><div class="ec-line highlight ins" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#D4D4D4;--1:#000000">  </span></span><span style="--0:#D4D4D4;--1:#000000">def </span><span style="--0:#C8C8C8;--1:#000000">A0</span><span style="--0:#D4D4D4;--1:#000000">   : NovaGPRReg&#x3C;</span><span style="--0:#CE9178;--1:#A31515">"4"</span><span style="--0:#D4D4D4;--1:#000000">>;</span></div></div><div class="ec-line highlight ins" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#D4D4D4;--1:#000000">  </span></span><span style="--0:#D4D4D4;--1:#000000">def </span><span style="--0:#C8C8C8;--1:#000000">A1</span><span style="--0:#D4D4D4;--1:#000000">   : NovaGPRReg&#x3C;</span><span style="--0:#CE9178;--1:#A31515">"5"</span><span style="--0:#D4D4D4;--1:#000000">>;</span></div></div><div class="ec-line highlight ins" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#D4D4D4;--1:#000000">  </span></span><span style="--0:#D4D4D4;--1:#000000">def </span><span style="--0:#C8C8C8;--1:#000000">A2</span><span style="--0:#D4D4D4;--1:#000000">   : NovaGPRReg&#x3C;</span><span style="--0:#CE9178;--1:#A31515">"6"</span><span style="--0:#D4D4D4;--1:#000000">>;</span></div></div><div class="ec-line highlight ins" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#D4D4D4;--1:#000000">  </span></span><span style="--0:#D4D4D4;--1:#000000">def </span><span style="--0:#C8C8C8;--1:#000000">A3</span><span style="--0:#D4D4D4;--1:#000000">   : NovaGPRReg&#x3C;</span><span style="--0:#CE9178;--1:#A31515">"7"</span><span style="--0:#D4D4D4;--1:#000000">>;</span></div></div><div class="ec-line highlight ins" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#D4D4D4;--1:#000000">  </span></span><span style="--0:#D4D4D4;--1:#000000">def </span><span style="--0:#C8C8C8;--1:#000000">T0</span><span style="--0:#D4D4D4;--1:#000000">   : NovaGPRReg&#x3C;</span><span style="--0:#CE9178;--1:#A31515">"8"</span><span style="--0:#D4D4D4;--1:#000000">>;</span></div></div><div class="ec-line highlight ins" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#D4D4D4;--1:#000000">  </span></span><span style="--0:#D4D4D4;--1:#000000">def </span><span style="--0:#C8C8C8;--1:#000000">T1</span><span style="--0:#D4D4D4;--1:#000000">   : NovaGPRReg&#x3C;</span><span style="--0:#CE9178;--1:#A31515">"9"</span><span style="--0:#D4D4D4;--1:#000000">>;</span></div></div><div class="ec-line highlight ins" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#D4D4D4;--1:#000000">  </span></span><span style="--0:#D4D4D4;--1:#000000">def </span><span style="--0:#C8C8C8;--1:#000000">T2</span><span style="--0:#D4D4D4;--1:#000000">   : NovaGPRReg&#x3C;</span><span style="--0:#CE9178;--1:#A31515">"10"</span><span style="--0:#D4D4D4;--1:#000000">>;</span></div></div><div class="ec-line highlight ins" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#D4D4D4;--1:#000000">  </span></span><span style="--0:#D4D4D4;--1:#000000">def </span><span style="--0:#C8C8C8;--1:#000000">T3</span><span style="--0:#D4D4D4;--1:#000000">   : NovaGPRReg&#x3C;</span><span style="--0:#CE9178;--1:#A31515">"11"</span><span style="--0:#D4D4D4;--1:#000000">>;</span></div></div><div class="ec-line highlight ins" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#D4D4D4;--1:#000000">  </span></span><span style="--0:#D4D4D4;--1:#000000">def </span><span style="--0:#C8C8C8;--1:#000000">T4</span><span style="--0:#D4D4D4;--1:#000000">   : NovaGPRReg&#x3C;</span><span style="--0:#CE9178;--1:#A31515">"12"</span><span style="--0:#D4D4D4;--1:#000000">>;</span></div></div><div class="ec-line highlight ins" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#D4D4D4;--1:#000000">  </span></span><span style="--0:#D4D4D4;--1:#000000">def </span><span style="--0:#C8C8C8;--1:#000000">T5</span><span style="--0:#D4D4D4;--1:#000000">   : NovaGPRReg&#x3C;</span><span style="--0:#CE9178;--1:#A31515">"13"</span><span style="--0:#D4D4D4;--1:#000000">>;</span></div></div><div class="ec-line highlight ins" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#D4D4D4;--1:#000000">  </span></span><span style="--0:#D4D4D4;--1:#000000">def </span><span style="--0:#C8C8C8;--1:#000000">T6</span><span style="--0:#D4D4D4;--1:#000000">   : NovaGPRReg&#x3C;</span><span style="--0:#CE9178;--1:#A31515">"14"</span><span style="--0:#D4D4D4;--1:#000000">>;</span></div></div><div class="ec-line highlight ins" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#D4D4D4;--1:#000000">  </span></span><span style="--0:#D4D4D4;--1:#000000">def </span><span style="--0:#C8C8C8;--1:#000000">T7</span><span style="--0:#D4D4D4;--1:#000000">   : NovaGPRReg&#x3C;</span><span style="--0:#CE9178;--1:#A31515">"15"</span><span style="--0:#D4D4D4;--1:#000000">>;</span></div></div><div class="ec-line highlight ins" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#D4D4D4;--1:#000000">  </span></span><span style="--0:#D4D4D4;--1:#000000">def </span><span style="--0:#C8C8C8;--1:#000000">S0</span><span style="--0:#D4D4D4;--1:#000000">   : NovaGPRReg&#x3C;</span><span style="--0:#CE9178;--1:#A31515">"16"</span><span style="--0:#D4D4D4;--1:#000000">>;</span></div></div><div class="ec-line highlight ins" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#D4D4D4;--1:#000000">  </span></span><span style="--0:#D4D4D4;--1:#000000">def </span><span style="--0:#C8C8C8;--1:#000000">S1</span><span style="--0:#D4D4D4;--1:#000000">   : NovaGPRReg&#x3C;</span><span style="--0:#CE9178;--1:#A31515">"17"</span><span style="--0:#D4D4D4;--1:#000000">>;</span></div></div><div class="ec-line highlight ins" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#D4D4D4;--1:#000000">  </span></span><span style="--0:#D4D4D4;--1:#000000">def </span><span style="--0:#C8C8C8;--1:#000000">S2</span><span style="--0:#D4D4D4;--1:#000000">   : NovaGPRReg&#x3C;</span><span style="--0:#CE9178;--1:#A31515">"18"</span><span style="--0:#D4D4D4;--1:#000000">>;</span></div></div><div class="ec-line highlight ins" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#D4D4D4;--1:#000000">  </span></span><span style="--0:#D4D4D4;--1:#000000">def </span><span style="--0:#C8C8C8;--1:#000000">S3</span><span style="--0:#D4D4D4;--1:#000000">   : NovaGPRReg&#x3C;</span><span style="--0:#CE9178;--1:#A31515">"19"</span><span style="--0:#D4D4D4;--1:#000000">>;</span></div></div><div class="ec-line highlight ins" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#D4D4D4;--1:#000000">  </span></span><span style="--0:#D4D4D4;--1:#000000">def </span><span style="--0:#C8C8C8;--1:#000000">S4</span><span style="--0:#D4D4D4;--1:#000000">   : NovaGPRReg&#x3C;</span><span style="--0:#CE9178;--1:#A31515">"20"</span><span style="--0:#D4D4D4;--1:#000000">>;</span></div></div><div class="ec-line highlight ins" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#D4D4D4;--1:#000000">  </span></span><span style="--0:#D4D4D4;--1:#000000">def </span><span style="--0:#C8C8C8;--1:#000000">S5</span><span style="--0:#D4D4D4;--1:#000000">   : NovaGPRReg&#x3C;</span><span style="--0:#CE9178;--1:#A31515">"21"</span><span style="--0:#D4D4D4;--1:#000000">>;</span></div></div><div class="ec-line highlight ins" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#D4D4D4;--1:#000000">  </span></span><span style="--0:#D4D4D4;--1:#000000">def </span><span style="--0:#C8C8C8;--1:#000000">S6</span><span style="--0:#D4D4D4;--1:#000000">   : NovaGPRReg&#x3C;</span><span style="--0:#CE9178;--1:#A31515">"22"</span><span style="--0:#D4D4D4;--1:#000000">>;</span></div></div></div></div><div class="ec-line highlight ins" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#D4D4D4;--1:#000000">  </span></span><span style="--0:#D4D4D4;--1:#000000">def </span><span style="--0:#C8C8C8;--1:#000000">S7</span><span style="--0:#D4D4D4;--1:#000000">   : NovaGPRReg&#x3C;</span><span style="--0:#CE9178;--1:#A31515">"23"</span><span style="--0:#D4D4D4;--1:#000000">>;</span></div></div><div class="ec-line highlight ins" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#D4D4D4;--1:#000000">  </span></span><span style="--0:#D4D4D4;--1:#000000">def </span><span style="--0:#C8C8C8;--1:#000000">T8</span><span style="--0:#D4D4D4;--1:#000000">   : NovaGPRReg&#x3C;</span><span style="--0:#CE9178;--1:#A31515">"24"</span><span style="--0:#D4D4D4;--1:#000000">>;</span></div></div><div class="ec-line highlight ins" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#D4D4D4;--1:#000000">  </span></span><span style="--0:#D4D4D4;--1:#000000">def </span><span style="--0:#C8C8C8;--1:#000000">T9</span><span style="--0:#D4D4D4;--1:#000000">   : NovaGPRReg&#x3C;</span><span style="--0:#CE9178;--1:#A31515">"25"</span><span style="--0:#D4D4D4;--1:#000000">>;</span></div></div><div class="ec-line highlight ins" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#D4D4D4;--1:#000000">  </span></span><span style="--0:#D4D4D4;--1:#000000">def </span><span style="--0:#C8C8C8;--1:#000000">K0</span><span style="--0:#D4D4D4;--1:#000000">   : NovaGPRReg&#x3C;</span><span style="--0:#CE9178;--1:#A31515">"26"</span><span style="--0:#D4D4D4;--1:#000000">>;</span></div></div><div class="ec-line highlight ins" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#D4D4D4;--1:#000000">  </span></span><span style="--0:#D4D4D4;--1:#000000">def </span><span style="--0:#C8C8C8;--1:#000000">K1</span><span style="--0:#D4D4D4;--1:#000000">   : NovaGPRReg&#x3C;</span><span style="--0:#CE9178;--1:#A31515">"27"</span><span style="--0:#D4D4D4;--1:#000000">>;</span></div></div><div class="ec-line highlight ins" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#D4D4D4;--1:#000000">  </span></span><span style="--0:#D4D4D4;--1:#000000">def </span><span style="--0:#C8C8C8;--1:#000000">GP</span><span style="--0:#D4D4D4;--1:#000000">   : NovaGPRReg&#x3C;</span><span style="--0:#CE9178;--1:#A31515">"gp"</span><span style="--0:#D4D4D4;--1:#000000">>;</span><span style="--0:#80a86f;--1:#007000"> // 28</span></div></div><div class="ec-line highlight ins" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#D4D4D4;--1:#000000">  </span></span><span style="--0:#D4D4D4;--1:#000000">def </span><span style="--0:#C8C8C8;--1:#000000">SP</span><span style="--0:#D4D4D4;--1:#000000">   : NovaGPRReg&#x3C;</span><span style="--0:#CE9178;--1:#A31515">"sp"</span><span style="--0:#D4D4D4;--1:#000000">>;</span><span style="--0:#80a86f;--1:#007000"> // 29</span></div></div><div class="ec-line highlight ins" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#D4D4D4;--1:#000000">  </span></span><span style="--0:#D4D4D4;--1:#000000">def </span><span style="--0:#C8C8C8;--1:#000000">FP</span><span style="--0:#D4D4D4;--1:#000000">   : NovaGPRReg&#x3C;</span><span style="--0:#CE9178;--1:#A31515">"fp"</span><span style="--0:#D4D4D4;--1:#000000">>;</span><span style="--0:#80a86f;--1:#007000"> // 30</span></div></div><div class="ec-line highlight ins" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#D4D4D4;--1:#000000">  </span></span><span style="--0:#D4D4D4;--1:#000000">def </span><span style="--0:#C8C8C8;--1:#000000">RA</span><span style="--0:#D4D4D4;--1:#000000">   : NovaGPRReg&#x3C;</span><span style="--0:#CE9178;--1:#A31515">"ra"</span><span style="--0:#D4D4D4;--1:#000000">>;</span><span style="--0:#80a86f;--1:#007000"> // 31</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins" style="--ecIndent:2ch"><div class="code"><span style="--0:#80a86f;--1:#007000"><span class="indent">  </span>//== Special registers ==//</span></div></div><div class="ec-line highlight ins" style="--ecIndent:2ch"><div class="code"><span style="--0:#80a86f;--1:#007000"><span class="indent">  </span>//=======================//</span></div></div><div class="ec-line highlight ins" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#D4D4D4;--1:#000000">  </span></span><span style="--0:#D4D4D4;--1:#000000">def </span><span style="--0:#C8C8C8;--1:#000000">PC</span><span style="--0:#D4D4D4;--1:#000000">   : NovaReg&#x3C;</span><span style="--0:#CE9178;--1:#A31515">"pc"</span><span style="--0:#D4D4D4;--1:#000000">>;</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#D4D4D4;--1:#000000">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="// Nova CPU Registersclass NovaReg<string n> : Register<n> {    let Namespace = &#x22;Nova&#x22;;}class NovaGPRReg<string n> : Register<n> {    let Namespace = &#x22;Nova&#x22;;}let Namespace = &#x22;Nova&#x22; in {  def ZERO : NovaGPRReg<&#x22;zero&#x22;> {    let isConstant = 1;  }  def AT   : NovaGPRReg<&#x22;at&#x22;>;  def V0   : NovaGPRReg<&#x22;2&#x22;>;  def V1   : NovaGPRReg<&#x22;3&#x22;>;  def A0   : NovaGPRReg<&#x22;4&#x22;>;  def A1   : NovaGPRReg<&#x22;5&#x22;>;  def A2   : NovaGPRReg<&#x22;6&#x22;>;  def A3   : NovaGPRReg<&#x22;7&#x22;>;  def T0   : NovaGPRReg<&#x22;8&#x22;>;  def T1   : NovaGPRReg<&#x22;9&#x22;>;  def T2   : NovaGPRReg<&#x22;10&#x22;>;  def T3   : NovaGPRReg<&#x22;11&#x22;>;  def T4   : NovaGPRReg<&#x22;12&#x22;>;  def T5   : NovaGPRReg<&#x22;13&#x22;>;  def T6   : NovaGPRReg<&#x22;14&#x22;>;  def T7   : NovaGPRReg<&#x22;15&#x22;>;  def S0   : NovaGPRReg<&#x22;16&#x22;>;  def S1   : NovaGPRReg<&#x22;17&#x22;>;  def S2   : NovaGPRReg<&#x22;18&#x22;>;  def S3   : NovaGPRReg<&#x22;19&#x22;>;  def S4   : NovaGPRReg<&#x22;20&#x22;>;  def S5   : NovaGPRReg<&#x22;21&#x22;>;  def S6   : NovaGPRReg<&#x22;22&#x22;>;  def S7   : NovaGPRReg<&#x22;23&#x22;>;  def T8   : NovaGPRReg<&#x22;24&#x22;>;  def T9   : NovaGPRReg<&#x22;25&#x22;>;  def K0   : NovaGPRReg<&#x22;26&#x22;>;  def K1   : NovaGPRReg<&#x22;27&#x22;>;  def GP   : NovaGPRReg<&#x22;gp&#x22;>; // 28  def SP   : NovaGPRReg<&#x22;sp&#x22;>; // 29  def FP   : NovaGPRReg<&#x22;fp&#x22;>; // 30  def RA   : NovaGPRReg<&#x22;ra&#x22;>; // 31  //== Special registers ==//  //=======================//  def PC   : NovaReg<&#x22;pc&#x22;>;}"><div></div></button></div></figure></div> </div>
<p>With this, we can see the tablgen records for the registers.</p>
<div class="expressive-code"><link rel="stylesheet" href="/_astro/ec.678xb.css"><script type="module" src="/_astro/ec.8zarh.js"></script><figure class="frame is-terminal has-title not-content"><figcaption class="header"><span class="title">Viewing the tablegen output</span></figcaption><pre data-language="bash" class="wrap" style="--ecMaxLine:88ch"><code><div class="ec-line"><div class="code"><span style="--0:#DCDCAA;--1:#795E26">cd</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#CE9178;--1:#A31515">llvm/lib/Target/Nova</span></div></div><div class="ec-line"><div class="code"><span style="--0:#DCDCAA;--1:#795E26">.</span><span style="--0:#CE9178;--1:#A31515">./</span><span style="--0:#DCDCAA;--1:#795E26">.</span><span style="--0:#CE9178;--1:#A31515">./</span><span style="--0:#DCDCAA;--1:#795E26">.</span><span style="--0:#CE9178;--1:#A31515">./</span><span style="--0:#DCDCAA;--1:#795E26">.</span><span style="--0:#CE9178;--1:#A31515">./build/bin/llvm-tblgen</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#CE9178;--1:#A31515">Nova.td</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#569CD6;--1:#0000FF">-I=../../../include</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#569CD6;--1:#0000FF">-print-records</span><span style="--0:#D4D4D4;--1:#000000"> | </span><span style="--0:#DCDCAA;--1:#795E26">grep</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#CE9178;--1:#A31515">Nova</span></div></div></code></pre><pre class="output"><div></div><div>def A0 {        // Register NovaGPRReg</div><div>  string Namespace = "Nova";</div><div>  string AsmName = "4";</div><div>  list&#x3C;string> AltNames = [];</div><div>  list&#x3C;Register> Aliases = [];</div><div>  list&#x3C;Register> SubRegs = [];</div></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="cd llvm/lib/Target/Nova../../../../build/bin/llvm-tblgen Nova.td -I=../../../include -print-records | grep Nova"><div></div></button></div></figure></div>
<p>Next, we need to group these registers into register classes.</p>
<h2 id="register-classes-rc">Register classes (RC)</h2>

<p>A register class is a set of registers that can be used interchangeably in an instruction. For example, the <code dir="auto">GPR</code> register class contains all the general-purpose registers.</p>
<ul>
<li>
<p>All virtual registers have a register class assigned.</p>
</li>
<li>
<p>The register allocator also uses the RC to allocate physical registers.</p>
</li>
<li>
<p>A new register class needs to be created for defining register constraints.</p>
</li>
</ul>
<p>Our general purpose registers will go into the <code dir="auto">GPR32</code> register
class which is defined as a tablgen record deriving from the
<code dir="auto">RegisterClass</code> class.</p>
<div class="code-snippet astro-xvlhowr4"> <!-- for the after context div -->  <!-- for other contexts -->  <div class="expressive-code astro-xvlhowr4"><figure class="frame has-title not-content"><figcaption class="header"><span class="title">llvm/lib/Target/Nova/NovaRegisterInfo.td(nova-reg-class)</span></figcaption><pre data-language="cpp" class="wrap" style="--ecMaxLine:33ch"><code><div class="ec-line highlight ins"><div class="code"><span style="--0:#80a86f;--1:#007000">//=== -----------------</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#80a86f;--1:#007000">// Register Classes</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#80a86f;--1:#007000">//=== -----------------</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#D4D4D4;--1:#000000">def GPR32 : RegisterClass&#x3C;</span><span style="--0:#CE9178;--1:#A31515">"Nova"</span><span style="--0:#D4D4D4;--1:#000000">,</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="//=== -----------------// Register Classes//=== -----------------def GPR32 : RegisterClass<&#x22;Nova&#x22;,"><div></div></button></div></figure></div> </div>
<p><code dir="auto">"Nova"</code> is the namespace for the generated definitions by tablgen.</p>
<p>Next, we mention the type of values these registers can hold.
For our case, these are all 32-bit integers.</p>
<div class="code-snippet astro-xvlhowr4"> <!-- for the after context div -->  <!-- for other contexts -->  <div class="expressive-code astro-xvlhowr4"><figure class="frame has-title not-content"><figcaption class="header"><span class="title">llvm/lib/Target/Nova/NovaRegisterInfo.td(nova-reg-class1)</span></figcaption><pre data-language="cpp" class="wrap" style="--ecMaxLine:33ch"><code><div class="ec-line"><div class="code"><span style="--0:#D4D4D4;--1:#000000">def GPR32 : RegisterClass&#x3C;</span><span style="--0:#CE9178;--1:#A31515">"Nova"</span><span style="--0:#D4D4D4;--1:#000000">,</span></div></div><div class="ec-line highlight ins" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#D4D4D4;--1:#000000">  </span></span><span style="--0:#D4D4D4;--1:#000000">[</span><span style="--0:#9CDCFE;--1:#001080">i32</span><span style="--0:#D4D4D4;--1:#000000">],</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="def GPR32 : RegisterClass<&#x22;Nova&#x22;,  [i32],"><div></div></button></div></figure></div> </div>
<p>The alignment of the register is set to 4 bytes.</p>
<div class="code-snippet astro-xvlhowr4"> <!-- for the after context div -->  <!-- for other contexts -->  <div class="expressive-code astro-xvlhowr4"><figure class="frame has-title not-content"><figcaption class="header"><span class="title">llvm/lib/Target/Nova/NovaRegisterInfo.td(nova-reg-class2)</span></figcaption><pre data-language="cpp" class="wrap" style="--ecMaxLine:33ch"><code><div class="ec-line"><div class="code"><span style="--0:#D4D4D4;--1:#000000">def GPR32 : RegisterClass&#x3C;</span><span style="--0:#CE9178;--1:#A31515">"Nova"</span><span style="--0:#D4D4D4;--1:#000000">,</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#D4D4D4;--1:#000000">  </span></span><span style="--0:#D4D4D4;--1:#000000">[</span><span style="--0:#9CDCFE;--1:#001080">i32</span><span style="--0:#D4D4D4;--1:#000000">],</span></div></div><div class="ec-line highlight ins" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#D4D4D4;--1:#000000">  </span></span><span style="--0:#D4D4D4;--1:#000000">32,</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="def GPR32 : RegisterClass<&#x22;Nova&#x22;,  [i32],  32,"><div></div></button></div></figure></div> </div>
<p>Now we list all the registers in this class.</p>
<div class="code-snippet astro-xvlhowr4"> <!-- for the after context div -->  <!-- for other contexts -->  <div class="expressive-code astro-xvlhowr4"><figure class="frame has-title not-content"><figcaption class="header"><span class="title">llvm/lib/Target/Nova/NovaRegisterInfo.td(nova-reg-class3)</span></figcaption><pre data-language="cpp" class="wrap" style="--ecMaxLine:80ch"><code><div class="ec-line"><div class="code"><span style="--0:#D4D4D4;--1:#000000">def GPR32 : RegisterClass&#x3C;</span><span style="--0:#CE9178;--1:#A31515">"Nova"</span><span style="--0:#D4D4D4;--1:#000000">,</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#D4D4D4;--1:#000000">  </span></span><span style="--0:#D4D4D4;--1:#000000">[</span><span style="--0:#9CDCFE;--1:#001080">i32</span><span style="--0:#D4D4D4;--1:#000000">],</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#D4D4D4;--1:#000000">  </span></span><span style="--0:#D4D4D4;--1:#000000">32,</span></div></div><div class="ec-line highlight ins" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#D4D4D4;--1:#000000">  </span></span><span style="--0:#D4D4D4;--1:#000000">(</span><span style="--0:#4EC9B0;--1:#1f687d">add</span></div></div><div class="ec-line highlight ins" style="--ecIndent:3ch"><div class="code"><span style="--0:#80a86f;--1:#007000"><span class="indent">   </span>// Reserved</span></div></div><div class="ec-line highlight ins" style="--ecIndent:3ch"><div class="code"><span class="indent">   </span><span style="--0:#9CDCFE;--1:#001080">ZERO</span><span style="--0:#D4D4D4;--1:#000000">, </span><span style="--0:#4EC9B0;--1:#1f687d">AT</span><span style="--0:#D4D4D4;--1:#000000">,</span></div></div><div class="ec-line highlight ins" style="--ecIndent:3ch"><div class="code"><span style="--0:#80a86f;--1:#007000"><span class="indent">   </span>// Return values and arguments</span></div></div><div class="ec-line highlight ins" style="--ecIndent:3ch"><div class="code"><span class="indent">   </span><span style="--0:#4EC9B0;--1:#1f687d">V0</span><span style="--0:#D4D4D4;--1:#000000">, </span><span style="--0:#4EC9B0;--1:#1f687d">V1</span><span style="--0:#D4D4D4;--1:#000000">,</span></div></div><div class="ec-line highlight ins" style="--ecIndent:3ch"><div class="code"><span class="indent">   </span><span style="--0:#4EC9B0;--1:#1f687d">A0</span><span style="--0:#D4D4D4;--1:#000000">, </span><span style="--0:#4EC9B0;--1:#1f687d">A1</span><span style="--0:#D4D4D4;--1:#000000">, </span><span style="--0:#4EC9B0;--1:#1f687d">A2</span><span style="--0:#D4D4D4;--1:#000000">, </span><span style="--0:#4EC9B0;--1:#1f687d">A3</span><span style="--0:#D4D4D4;--1:#000000">,</span></div></div><div class="ec-line highlight ins" style="--ecIndent:3ch"><div class="code"><span style="--0:#80a86f;--1:#007000"><span class="indent">   </span>// Caller-saved temporaries (not preserved across calls, clobbered by callee)</span></div></div><div class="ec-line highlight ins" style="--ecIndent:3ch"><div class="code"><span class="indent">   </span><span style="--0:#4EC9B0;--1:#1f687d">T0</span><span style="--0:#D4D4D4;--1:#000000">, </span><span style="--0:#4EC9B0;--1:#1f687d">T1</span><span style="--0:#D4D4D4;--1:#000000">, </span><span style="--0:#4EC9B0;--1:#1f687d">T2</span><span style="--0:#D4D4D4;--1:#000000">, </span><span style="--0:#4EC9B0;--1:#1f687d">T3</span><span style="--0:#D4D4D4;--1:#000000">, </span><span style="--0:#4EC9B0;--1:#1f687d">T4</span><span style="--0:#D4D4D4;--1:#000000">, </span><span style="--0:#4EC9B0;--1:#1f687d">T5</span><span style="--0:#D4D4D4;--1:#000000">, </span><span style="--0:#4EC9B0;--1:#1f687d">T6</span><span style="--0:#D4D4D4;--1:#000000">, </span><span style="--0:#4EC9B0;--1:#1f687d">T7</span><span style="--0:#D4D4D4;--1:#000000">,</span></div></div><div class="ec-line highlight ins" style="--ecIndent:3ch"><div class="code"><span style="--0:#80a86f;--1:#007000"><span class="indent">   </span>// Callee-saved (preserved across calls)</span></div></div><div class="ec-line highlight ins" style="--ecIndent:3ch"><div class="code"><span class="indent">   </span><span style="--0:#4EC9B0;--1:#1f687d">S0</span><span style="--0:#D4D4D4;--1:#000000">, </span><span style="--0:#4EC9B0;--1:#1f687d">S1</span><span style="--0:#D4D4D4;--1:#000000">, </span><span style="--0:#4EC9B0;--1:#1f687d">S2</span><span style="--0:#D4D4D4;--1:#000000">, </span><span style="--0:#4EC9B0;--1:#1f687d">S3</span><span style="--0:#D4D4D4;--1:#000000">, </span><span style="--0:#4EC9B0;--1:#1f687d">S4</span><span style="--0:#D4D4D4;--1:#000000">, </span><span style="--0:#4EC9B0;--1:#1f687d">S5</span><span style="--0:#D4D4D4;--1:#000000">, </span><span style="--0:#4EC9B0;--1:#1f687d">S6</span><span style="--0:#D4D4D4;--1:#000000">, </span><span style="--0:#4EC9B0;--1:#1f687d">S7</span><span style="--0:#D4D4D4;--1:#000000">,</span></div></div><div class="ec-line highlight ins" style="--ecIndent:3ch"><div class="code"><span style="--0:#80a86f;--1:#007000"><span class="indent">   </span>// More caller-saved temporaries</span></div></div><div class="ec-line highlight ins" style="--ecIndent:3ch"><div class="code"><span class="indent">   </span><span style="--0:#4EC9B0;--1:#1f687d">T8</span><span style="--0:#D4D4D4;--1:#000000">, </span><span style="--0:#4EC9B0;--1:#1f687d">T9</span><span style="--0:#D4D4D4;--1:#000000">,</span></div></div><div class="ec-line highlight ins" style="--ecIndent:3ch"><div class="code"><span style="--0:#80a86f;--1:#007000"><span class="indent">   </span>// Kernel registers</span></div></div><div class="ec-line highlight ins" style="--ecIndent:3ch"><div class="code"><span class="indent">   </span><span style="--0:#4EC9B0;--1:#1f687d">K0</span><span style="--0:#D4D4D4;--1:#000000">, </span><span style="--0:#4EC9B0;--1:#1f687d">K1</span><span style="--0:#D4D4D4;--1:#000000">,</span></div></div><div class="ec-line highlight ins" style="--ecIndent:3ch"><div class="code"><span style="--0:#80a86f;--1:#007000"><span class="indent">   </span>// Global pointer</span></div></div><div class="ec-line highlight ins" style="--ecIndent:3ch"><div class="code"><span class="indent">   </span><span style="--0:#4EC9B0;--1:#1f687d">GP</span><span style="--0:#D4D4D4;--1:#000000">,</span></div></div><div class="ec-line highlight ins" style="--ecIndent:3ch"><div class="code"><span style="--0:#80a86f;--1:#007000"><span class="indent">   </span>// Stack pointer</span></div></div><div class="ec-line highlight ins" style="--ecIndent:3ch"><div class="code"><span class="indent">   </span><span style="--0:#4EC9B0;--1:#1f687d">SP</span><span style="--0:#D4D4D4;--1:#000000">,</span></div></div><div class="ec-line highlight ins" style="--ecIndent:3ch"><div class="code"><span style="--0:#80a86f;--1:#007000"><span class="indent">   </span>// Frmame pointer</span></div></div><div class="ec-line highlight ins" style="--ecIndent:3ch"><div class="code"><span class="indent">   </span><span style="--0:#4EC9B0;--1:#1f687d">FP</span><span style="--0:#D4D4D4;--1:#000000">,</span></div></div><div class="ec-line highlight ins" style="--ecIndent:3ch"><div class="code"><span style="--0:#80a86f;--1:#007000"><span class="indent">   </span>// Return address (mostly used by instruction "jal")</span></div></div><div class="ec-line highlight ins" style="--ecIndent:3ch"><div class="code"><span class="indent">   </span><span style="--0:#4EC9B0;--1:#1f687d">RA</span><span style="--0:#D4D4D4;--1:#000000">)>;</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="def GPR32 : RegisterClass<&#x22;Nova&#x22;,  [i32],  32,  (add   // Reserved   ZERO, AT,   // Return values and arguments   V0, V1,   A0, A1, A2, A3,   // Caller-saved temporaries (not preserved across calls, clobbered by callee)   T0, T1, T2, T3, T4, T5, T6, T7,   // Callee-saved (preserved across calls)   S0, S1, S2, S3, S4, S5, S6, S7,   // More caller-saved temporaries   T8, T9,   // Kernel registers   K0, K1,   // Global pointer   GP,   // Stack pointer   SP,   // Frmame pointer   FP,   // Return address (mostly used by instruction &#x22;jal&#x22;)   RA)>;"><div></div></button></div></figure></div> </div>
<h3 id="other-register-classes">Other Register classes</h3>
<p>Since we need constraints on allocation (<code dir="auto">$zero</code> should always be an operand 0),
we need another register class for it.</p>
<div class="code-snippet astro-xvlhowr4"> <!-- for the after context div -->  <!-- for other contexts -->  <div class="expressive-code astro-xvlhowr4"><figure class="frame has-title not-content"><figcaption class="header"><span class="title">llvm/lib/Target/Nova/NovaRegisterInfo.td(nova-rc-zero)</span></figcaption><pre data-language="cpp" class="wrap" style="--ecMaxLine:61ch"><code><div class="ec-line" style="--ecIndent:3ch"><div class="code"><span class="indent"><span style="--0:#74A061;--1:#007A00">   </span></span><span style="--0:#74A061;--1:#007A00">// Return address (mostly used by instruction "jal")</span></div></div><div class="ec-line" style="--ecIndent:3ch"><div class="code"><span class="indent"><span style="--0:#D4D4D4;--1:#000000">   </span></span><span style="--0:#D4D4D4;--1:#000000">RA)>;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#D4D4D4;--1:#000000">def GPR32ZERO : RegisterClass&#x3C;</span><span style="--0:#CE9178;--1:#A31515">"Nova"</span><span style="--0:#D4D4D4;--1:#000000">, [</span><span style="--0:#9CDCFE;--1:#001080">i32</span><span style="--0:#D4D4D4;--1:#000000">], 32, (</span><span style="--0:#4EC9B0;--1:#1f687d">add</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#9CDCFE;--1:#001080">ZERO</span><span style="--0:#D4D4D4;--1:#000000">)>;</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="   // Return address (mostly used by instruction &#x22;jal&#x22;)   RA)>;def GPR32ZERO : RegisterClass<&#x22;Nova&#x22;, [i32], 32, (add ZERO)>;"><div></div></button></div></figure></div> </div>
<p>For the rest, we need another class. We can be clever here and
use the set difference operator instead of listing all of them again.</p>
<div class="code-snippet astro-xvlhowr4"> <!-- for the after context div -->  <!-- for other contexts -->  <div class="expressive-code astro-xvlhowr4"><figure class="frame has-title not-content"><figcaption class="header"><span class="title">llvm/lib/Target/Nova/NovaRegisterInfo.td(nova-rc-nonzero)</span></figcaption><pre data-language="cpp" class="wrap" style="--ecMaxLine:76ch"><code><div class="ec-line"><div class="code"><span style="--0:#D4D4D4;--1:#000000">def GPR32ZERO : RegisterClass&#x3C;</span><span style="--0:#CE9178;--1:#A31515">"Nova"</span><span style="--0:#D4D4D4;--1:#000000">, [</span><span style="--0:#9CDCFE;--1:#001080">i32</span><span style="--0:#D4D4D4;--1:#000000">], 32, (</span><span style="--0:#4EC9B0;--1:#227188">add</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#9CDCFE;--1:#001080">ZERO</span><span style="--0:#D4D4D4;--1:#000000">)>;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#D4D4D4;--1:#000000">def GPR32NONZERO : RegisterClass&#x3C;</span><span style="--0:#CE9178;--1:#A31515">"Nova"</span><span style="--0:#D4D4D4;--1:#000000">, [</span><span style="--0:#9CDCFE;--1:#001080">i32</span><span style="--0:#D4D4D4;--1:#000000">], 32, (</span><span style="--0:#4EC9B0;--1:#1f687d">sub</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#9CDCFE;--1:#001080">GPR32</span><span style="--0:#D4D4D4;--1:#000000">, </span><span style="--0:#4EC9B0;--1:#1f687d">GPR32ZERO</span><span style="--0:#D4D4D4;--1:#000000">)>;</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="def GPR32ZERO : RegisterClass<&#x22;Nova&#x22;, [i32], 32, (add ZERO)>;def GPR32NONZERO : RegisterClass<&#x22;Nova&#x22;, [i32], 32, (sub GPR32, GPR32ZERO)>;"><div></div></button></div></figure></div> </div>
<h4 id="unallocatable-registers">Unallocatable registers</h4>
<p>Special registers like <code dir="auto">$ra</code> are not to be allocatd by the register allocator to virtual registers.</p>
<div class="code-snippet astro-xvlhowr4"> <!-- for the after context div -->  <!-- for other contexts -->  <div class="expressive-code astro-xvlhowr4"><figure class="frame has-title not-content"><figcaption class="header"><span class="title">llvm/lib/Target/Nova/NovaRegisterInfo.td(nova-rc-unalloc)</span></figcaption><pre data-language="cpp" class="wrap" style="--ecMaxLine:76ch"><code><div class="ec-line"><div class="code"><span style="--0:#D4D4D4;--1:#000000">def GPR32NONZERO : RegisterClass&#x3C;</span><span style="--0:#CE9178;--1:#A31515">"Nova"</span><span style="--0:#D4D4D4;--1:#000000">, [</span><span style="--0:#9CDCFE;--1:#001080">i32</span><span style="--0:#D4D4D4;--1:#000000">], 32, (</span><span style="--0:#4EC9B0;--1:#227188">sub</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#9CDCFE;--1:#001080">GPR32</span><span style="--0:#D4D4D4;--1:#000000">, </span><span style="--0:#4EC9B0;--1:#227188">GPR32ZERO</span><span style="--0:#D4D4D4;--1:#000000">)>;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#D4D4D4;--1:#000000">let isAllocatable = </span><span style="--0:#62a3d9;--1:#0000FF">false</span><span style="--0:#D4D4D4;--1:#000000"> in {</span></div></div><div class="ec-line highlight ins" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#D4D4D4;--1:#000000">  </span></span><span style="--0:#D4D4D4;--1:#000000">def </span><span style="--0:#C8C8C8;--1:#000000">CPURAReg</span><span style="--0:#D4D4D4;--1:#000000"> : RegisterClass&#x3C;</span><span style="--0:#CE9178;--1:#A31515">"Nova"</span><span style="--0:#D4D4D4;--1:#000000">, [</span><span style="--0:#9CDCFE;--1:#001080">i32</span><span style="--0:#D4D4D4;--1:#000000">], 32, (</span><span style="--0:#4EC9B0;--1:#1f687d">add</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#9CDCFE;--1:#001080">RA</span><span style="--0:#D4D4D4;--1:#000000">)>;</span></div></div><div class="ec-line highlight ins" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#D4D4D4;--1:#000000">  </span></span><span style="--0:#D4D4D4;--1:#000000">def </span><span style="--0:#C8C8C8;--1:#000000">CPUSPReg</span><span style="--0:#D4D4D4;--1:#000000"> : RegisterClass&#x3C;</span><span style="--0:#CE9178;--1:#A31515">"Nova"</span><span style="--0:#D4D4D4;--1:#000000">, [</span><span style="--0:#9CDCFE;--1:#001080">i32</span><span style="--0:#D4D4D4;--1:#000000">], 32, (</span><span style="--0:#4EC9B0;--1:#1f687d">add</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#9CDCFE;--1:#001080">SP</span><span style="--0:#D4D4D4;--1:#000000">)>;</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#D4D4D4;--1:#000000">  </span></span><span style="--0:#D4D4D4;--1:#000000">def </span><span style="--0:#C8C8C8;--1:#000000">GP32</span><span style="--0:#D4D4D4;--1:#000000"> : RegisterClass&#x3C;</span><span style="--0:#CE9178;--1:#A31515">"Nova"</span><span style="--0:#D4D4D4;--1:#000000">, [</span><span style="--0:#9CDCFE;--1:#001080">i32</span><span style="--0:#D4D4D4;--1:#000000">], 32, (</span><span style="--0:#4EC9B0;--1:#1f687d">add</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#9CDCFE;--1:#001080">GP</span><span style="--0:#D4D4D4;--1:#000000">)>;</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#D4D4D4;--1:#000000">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="def GPR32NONZERO : RegisterClass<&#x22;Nova&#x22;, [i32], 32, (sub GPR32, GPR32ZERO)>;let isAllocatable = false in {  def CPURAReg : RegisterClass<&#x22;Nova&#x22;, [i32], 32, (add RA)>;  def CPUSPReg : RegisterClass<&#x22;Nova&#x22;, [i32], 32, (add SP)>;  def GP32 : RegisterClass<&#x22;Nova&#x22;, [i32], 32, (add GP)>;}"><div></div></button></div></figure></div> </div>
<h2 id="generating-the-inc-file">Generating the <code dir="auto">.inc</code> file</h2>

<p>ðŸš€ We have our basic register definitions in place!</p>
<p>To generate the enum values for our registers, we need to instruct cmake to invoke
<code dir="auto">llvm-tblgen</code> on our <code dir="auto">Nova.td</code> file.</p>
<h3 id="tablegen-output">TableGen output</h3>
<p>To generate our register file into, we use the <code dir="auto">-gen-register-info</code> TableGen backend.</p>
<div class="sl-link-card astro-mf7fz2mj"> <span class="sl-flex stack astro-mf7fz2mj"> <a href="https://llvm.org/docs/TableGen/BackEnds.html#registerinfo" class="astro-mf7fz2mj"> <span class="title astro-mf7fz2mj">Register Info TableGen backend</span> </a>  </span> <svg aria-hidden="true" class="icon rtl:flip astro-mf7fz2mj astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.333em;"><path d="M17.92 11.62a1.001 1.001 0 0 0-.21-.33l-5-5a1.003 1.003 0 1 0-1.42 1.42l3.3 3.29H7a1 1 0 0 0 0 2h7.59l-3.3 3.29a1.002 1.002 0 0 0 .325 1.639 1 1 0 0 0 1.095-.219l5-5a1 1 0 0 0 .21-.33 1 1 0 0 0 0-.76Z"/></svg>  </div> 
<p>Letâ€™s see what we get from this backend. Run <code dir="auto">llvm-tblgen</code> with our top level td file
with the backend enabled.</p>
<div class="expressive-code"><figure class="frame is-terminal has-title not-content"><figcaption class="header"><span class="title">Register info from td</span></figcaption><pre data-language="bash" class="wrap" style="--ecMaxLine:88ch"><code><div class="ec-line"><div class="code"><span style="--0:#DCDCAA;--1:#795E26">cd</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#CE9178;--1:#A31515">llvm/lib/Target/Nova</span></div></div><div class="ec-line"><div class="code"><span style="--0:#DCDCAA;--1:#795E26">.</span><span style="--0:#CE9178;--1:#A31515">./</span><span style="--0:#DCDCAA;--1:#795E26">.</span><span style="--0:#CE9178;--1:#A31515">./</span><span style="--0:#DCDCAA;--1:#795E26">.</span><span style="--0:#CE9178;--1:#A31515">./</span><span style="--0:#DCDCAA;--1:#795E26">.</span><span style="--0:#CE9178;--1:#A31515">./build/bin/llvm-tblgen</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#CE9178;--1:#A31515">Nova.td</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#569CD6;--1:#0000FF">-I=../../../include</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#569CD6;--1:#0000FF">-gen-register-info</span><span style="--0:#D4D4D4;--1:#000000"> > </span><span style="--0:#CE9178;--1:#A31515">reg.h</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="cd llvm/lib/Target/Nova../../../../build/bin/llvm-tblgen Nova.td -I=../../../include -gen-register-info > reg.h"><div></div></button></div></figure></div>
<p>â­ï¸ Weâ€™ll take a look at <code dir="auto">reg.h</code> to see what gets generated.</p>
<h2 id="llvm-classes">LLVM Classes</h2>
<p>We see that there is a class named <code dir="auto">MCRegisterClass</code> that is being forward declared. This class is defined in <code dir="auto">llvm/include/llvm/MC/MCRegisterInfo.h</code>. Letâ€™s work our way through this file and related files to understand the register classes in LLVM.</p>
<p>All these classes are in the <code dir="auto">MC</code> layer. The <code dir="auto">MC</code> layer is the Machine Code layer in LLVM. It is responsible for generating machine code for the target architecture and is used to for the lowest level of code generation.</p>
<h3 id="representing-registers">Representing Registers</h3>
<p>Registers are represented as <code dir="auto">unsigned</code> integers in LLVM. Have a look
at the small <code dir="auto">MCRegister.h</code> file.</p>
<ul>
<li><code dir="auto">MCPhysReg</code> is a physical register number.</li>
<li><code dir="auto">MCRegUnit</code> is a register unit number. Weâ€™ll see this later.</li>
<li><code dir="auto">MCRegister</code> wraps an unsigned integer as a physical register.</li>
</ul>
<p>The unsigned values are divided into ranges to designate different types of registers:</p>
<ul>
<li>0 stands for no register used. (Not-A-Register)</li>
<li>[1;2^30) are all physical registers (assigned by TableGen).</li>
<li>[2^31;2^32) are virtual registers.</li>
</ul>
<details><summary>Show source</summary><div class="code-snippet astro-xvlhowr4"> <!-- for the after context div -->  <!-- for other contexts --> <div class="context astro-xvlhowr4"> <span class="astro-xvlhowr4">â†’ namespace llvm {</span><br class="astro-xvlhowr4"><span class="astro-xvlhowr4">  â†³ class MCRegister {</span><br class="astro-xvlhowr4"></div> <div class="expressive-code astro-xvlhowr4"><figure class="frame has-title not-content"><figcaption class="header"><span class="title">llvm/include/llvm/MC/MCRegister.h(mc-register)</span></figcaption><pre data-language="cpp" class="wrap" style="--ecMaxLine:78ch"><code><div class="ec-line" style="--ecIndent:2ch"><div class="code"><span class="indent">  </span><span style="--0:#569CD6;--1:#0000FF">constexpr</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#DCDCAA;--1:#795E26">MCRegister</span><span style="--0:#D4D4D4;--1:#000000">(</span><span style="--0:#569CD6;--1:#0000FF">unsigned</span><span style="--0:#D4D4D4;--1:#000000"> Val = </span><span style="--0:#B5CEA8;--1:#08774E">0</span><span style="--0:#D4D4D4;--1:#000000">) : </span><span style="--0:#DCDCAA;--1:#795E26">Reg</span><span style="--0:#D4D4D4;--1:#000000">(Val) {}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line highlight mark" style="--ecIndent:2ch"><div class="code"><span style="--0:#7fa76d;--1:#62ad62"><span class="indent">  </span>// Register numbers can represent physical registers, virtual registers, and</span></div></div><div class="ec-line highlight mark" style="--ecIndent:2ch"><div class="code"><span style="--0:#7fa76d;--1:#62ad62"><span class="indent">  </span>// sometimes stack slots. The unsigned values are divided into these ranges:</span></div></div><div class="ec-line highlight mark" style="--ecIndent:2ch"><div class="code"><span style="--0:#7fa76d;--1:#62ad62"><span class="indent">  </span>//</span></div></div><div class="ec-line highlight mark" style="--ecIndent:2ch"><div class="code"><span style="--0:#7fa76d;--1:#62ad62"><span class="indent">  </span>//   0           Not a register, can be used as a sentinel.</span></div></div><div class="ec-line highlight mark" style="--ecIndent:2ch"><div class="code"><span style="--0:#7fa76d;--1:#62ad62"><span class="indent">  </span>//   [1;2^30)    Physical registers assigned by TableGen.</span></div></div><div class="ec-line highlight mark" style="--ecIndent:2ch"><div class="code"><span style="--0:#7fa76d;--1:#62ad62"><span class="indent">  </span>//   [2^30;2^31) Stack slots. (Rarely used.)</span></div></div><div class="ec-line highlight mark" style="--ecIndent:2ch"><div class="code"><span style="--0:#7fa76d;--1:#62ad62"><span class="indent">  </span>//   [2^31;2^32) Virtual registers assigned by MachineRegisterInfo.</span></div></div><div class="ec-line highlight mark" style="--ecIndent:2ch"><div class="code"><span style="--0:#7fa76d;--1:#62ad62"><span class="indent">  </span>//</span></div></div><div class="ec-line highlight mark" style="--ecIndent:2ch"><div class="code"><span style="--0:#7fa76d;--1:#62ad62"><span class="indent">  </span>// Further sentinels can be allocated from the small negative integers.</span></div></div><div class="ec-line highlight mark" style="--ecIndent:2ch"><div class="code"><span style="--0:#7fa76d;--1:#62ad62"><span class="indent">  </span>// DenseMapInfo&#x3C;unsigned> uses -1u and -2u.</span></div></div><div class="ec-line highlight mark" style="--ecIndent:2ch"><div class="code"><span class="indent">  </span><span style="--0:#60a2d8;--1:#9090ff">static_assert</span><span style="--0:#D4D4D4;--1:#9c9c9c">(</span><span style="--0:#4EC9B0;--1:#71a4b3">std</span><span style="--0:#D4D4D4;--1:#9c9c9c">::</span><span style="--0:#4EC9B0;--1:#71a4b3">numeric_limits</span><span style="--0:#D4D4D4;--1:#9c9c9c">&#x3C;</span><span style="--0:#60a2d8;--1:#9090ff">decltype</span><span style="--0:#D4D4D4;--1:#9c9c9c">(Reg)>::</span><span style="--0:#DCDCAA;--1:#ab9a77">max</span><span style="--0:#D4D4D4;--1:#9c9c9c">() >= </span><span style="--0:#B5CEA8;--1:#63a98f">0xFFFFFFFF</span><span style="--0:#D4D4D4;--1:#9c9c9c">,</span></div></div><div class="ec-line highlight mark" style="--ecIndent:16ch"><div class="code"><span class="indent">                </span><span style="--0:#CE9178;--1:#d18989">"Reg isn't large enough to hold full range."</span><span style="--0:#D4D4D4;--1:#9c9c9c">);</span></div></div><div class="ec-line highlight mark" style="--ecIndent:2ch"><div class="code"><span class="indent">  </span><span style="--0:#60a2d8;--1:#9090ff">static</span><span style="--0:#D4D4D4;--1:#9c9c9c"> </span><span style="--0:#60a2d8;--1:#9090ff">constexpr</span><span style="--0:#D4D4D4;--1:#9c9c9c"> </span><span style="--0:#60a2d8;--1:#9090ff">unsigned</span><span style="--0:#D4D4D4;--1:#9c9c9c"> NoRegister = </span><span style="--0:#B5CEA8;--1:#63a98f">0u</span><span style="--0:#D4D4D4;--1:#9c9c9c">;</span></div></div><div class="ec-line highlight mark" style="--ecIndent:2ch"><div class="code"><span class="indent">  </span><span style="--0:#60a2d8;--1:#9090ff">static</span><span style="--0:#D4D4D4;--1:#9c9c9c"> </span><span style="--0:#60a2d8;--1:#9090ff">constexpr</span><span style="--0:#D4D4D4;--1:#9c9c9c"> </span><span style="--0:#60a2d8;--1:#9090ff">unsigned</span><span style="--0:#D4D4D4;--1:#9c9c9c"> FirstPhysicalReg = </span><span style="--0:#B5CEA8;--1:#63a98f">1u</span><span style="--0:#D4D4D4;--1:#9c9c9c">;</span></div></div><div class="ec-line highlight mark" style="--ecIndent:2ch"><div class="code"><span class="indent">  </span><span style="--0:#60a2d8;--1:#9090ff">static</span><span style="--0:#D4D4D4;--1:#9c9c9c"> </span><span style="--0:#60a2d8;--1:#9090ff">constexpr</span><span style="--0:#D4D4D4;--1:#9c9c9c"> </span><span style="--0:#60a2d8;--1:#9090ff">unsigned</span><span style="--0:#D4D4D4;--1:#9c9c9c"> LastPhysicalReg = (</span><span style="--0:#B5CEA8;--1:#63a98f">1u</span><span style="--0:#D4D4D4;--1:#9c9c9c"> &#x3C;&#x3C; </span><span style="--0:#B5CEA8;--1:#63a98f">30</span><span style="--0:#D4D4D4;--1:#9c9c9c">) - </span><span style="--0:#B5CEA8;--1:#63a98f">1</span><span style="--0:#D4D4D4;--1:#9c9c9c">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#74A061;--1:#007A00">  </span></span><span style="--0:#74A061;--1:#007A00">/// Return true if the specified register number is in</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="  constexpr MCRegister(unsigned Val = 0) : Reg(Val) {}  // Register numbers can represent physical registers, virtual registers, and  // sometimes stack slots. The unsigned values are divided into these ranges:  //  //   0           Not a register, can be used as a sentinel.  //   [1;2^30)    Physical registers assigned by TableGen.  //   [2^30;2^31) Stack slots. (Rarely used.)  //   [2^31;2^32) Virtual registers assigned by MachineRegisterInfo.  //  // Further sentinels can be allocated from the small negative integers.  // DenseMapInfo<unsigned> uses -1u and -2u.  static_assert(std::numeric_limits<decltype(Reg)>::max() >= 0xFFFFFFFF,                &#x22;Reg isn&#x27;t large enough to hold full range.&#x22;);  static constexpr unsigned NoRegister = 0u;  static constexpr unsigned FirstPhysicalReg = 1u;  static constexpr unsigned LastPhysicalReg = (1u << 30) - 1;  /// Return true if the specified register number is in"><div></div></button></div></figure></div> </div></details>
<h4 id="register-class">Register Class</h4>
<p>The <code dir="auto">MCRegisterClass</code> denotes the register class and mirrors the <code dir="auto">RegisterClass</code> in the <code dir="auto">Target.td</code> file.</p>
<h4 id="register-description">Register Description</h4>
<p>The <code dir="auto">MCRegisterDesc</code> class is used to describe the register.
It contains the Name, SubRegs and SuperRegs along with other details.</p>
<h3 id="mcregisterinfo"><code dir="auto">MCRegisterInfo</code></h3>
<p>A static array of <code dir="auto">MCRegisterDesc</code> is used to define all registers in the target.
This class tracks a pointer to that array.</p>
<p>Most of this class is boilerplate code to access the register descriptions,
used by the TableGen backend. Some methods in this class are:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="cpp" class="wrap" style="--ecMaxLine:64ch"><code><div class="ec-line" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#74A061;--1:#007A00">  </span></span><span style="--0:#74A061;--1:#007A00">/// This method should return the register where the return</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#74A061;--1:#007A00">  </span></span><span style="--0:#74A061;--1:#007A00">/// address can be found.</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="code"><span class="indent">  </span><span style="--0:#4EC9B0;--1:#227188">MCRegister</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#DCDCAA;--1:#795E26">getRARegister</span><span style="--0:#D4D4D4;--1:#000000">() </span><span style="--0:#569CD6;--1:#0000FF">const</span><span style="--0:#D4D4D4;--1:#000000">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#74A061;--1:#007A00">  </span></span><span style="--0:#74A061;--1:#007A00">/// Return the register which is the program counter.</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="code"><span class="indent">  </span><span style="--0:#4EC9B0;--1:#227188">MCRegister</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#DCDCAA;--1:#795E26">getProgramCounter</span><span style="--0:#D4D4D4;--1:#000000">() </span><span style="--0:#569CD6;--1:#0000FF">const</span><span style="--0:#D4D4D4;--1:#000000">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#74A061;--1:#007A00">  </span></span><span style="--0:#74A061;--1:#007A00">/// Return the number of registers this target has (useful for</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#74A061;--1:#007A00">  </span></span><span style="--0:#74A061;--1:#007A00">/// sizing arrays holding per register information)</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="code"><span class="indent">  </span><span style="--0:#569CD6;--1:#0000FF">unsigned</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#DCDCAA;--1:#795E26">getNumRegs</span><span style="--0:#D4D4D4;--1:#000000">() </span><span style="--0:#569CD6;--1:#0000FF">const</span><span style="--0:#D4D4D4;--1:#000000">;</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="  /// This method should return the register where the return  /// address can be found.  MCRegister getRARegister() const;  /// Return the register which is the program counter.  MCRegister getProgramCounter() const;  /// Return the number of registers this target has (useful for  /// sizing arrays holding per register information)  unsigned getNumRegs() const;"><div></div></button></div></figure></div>
<h3 id="the-generated-file">The generated file</h3>
<p>We can now look at <code dir="auto">reg.h</code>, the generated file.</p>
<p>Enums are behind the <code dir="auto">GET_REGINFO_*</code> directive in the generated file.</p>
<p>We have the following things generated for us by tablegen:</p>
<ol>
<li>The register enums <code dir="auto">Nova::AT, Nova::RA, Nova::PC</code> etc.</li>
<li>Register class enums <code dir="auto">Nova::GPR32RegClassID, Nova::CPURARegRegClassID</code> etc.</li>
<li>Under <code dir="auto">GET_REGINFO_MC_DESC</code>, we have the <code dir="auto">InitNovaMCRegisterInfo</code> function that initializes the <code dir="auto">MCRegisterInfo</code>
instance for our backend. (these are the definitions, so need to go in a cpp file)</li>
<li>In <code dir="auto">GET_REGINFO_HEADER</code>, The <code dir="auto">NovaGenRegisterInfo</code> class definition, and</li>
<li>Register classes <code dir="auto">TargetRegisterClass GPR32RegisterClass</code> and others.</li>
<li>In <code dir="auto">GET_REGINFO_TARGET_DESC</code>, some functions like <code dir="auto">getRegUnitWeight(unsigned RegUnit)</code> and the constructor
for <code dir="auto">NovaGenRegisterInfo</code>.</li>
<li>Other functions like <code dir="auto">getFrameLowering()</code>: returns a <code dir="auto">NovaFrameLowering</code> object.</li>
</ol>
<h3 id="add-to-cmake">Add to cmake</h3>
<p>Tell cmake to generate the register info file.</p>
<div class="code-snippet astro-xvlhowr4"> <!-- for the after context div -->  <!-- for other contexts -->  <div class="expressive-code astro-xvlhowr4"><figure class="frame has-title not-content"><figcaption class="header"><span class="title">llvm/lib/Target/Nova/CMakeLists.txt(cmake-reg-info)</span></figcaption><pre data-language="cpp" class="wrap" style="--ecMaxLine:57ch"><code><div class="ec-line"><div class="code"><span style="--0:#DCDCAA;--1:#795E26">add_llvm_component_group</span><span style="--0:#D4D4D4;--1:#000000">(Nova)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#DCDCAA;--1:#775d25">set</span><span style="--0:#D4D4D4;--1:#000000">(LLVM_TARGET_DEFINITIONS </span><span style="--0:#9CDCFE;--1:#001080">Nova</span><span style="--0:#D4D4D4;--1:#000000">.</span><span style="--0:#9CDCFE;--1:#001080">td</span><span style="--0:#D4D4D4;--1:#000000">)</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#DCDCAA;--1:#775d25">tablegen</span><span style="--0:#D4D4D4;--1:#000000">(LLVM </span><span style="--0:#9CDCFE;--1:#001080">NovaGenRegisterInfo</span><span style="--0:#D4D4D4;--1:#000000">.</span><span style="--0:#9CDCFE;--1:#001080">inc</span><span style="--0:#D4D4D4;--1:#000000"> -gen-</span><span style="--0:#62a3d9;--1:#0000FF">register</span><span style="--0:#D4D4D4;--1:#000000">-info)</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#DCDCAA;--1:#775d25">tablegen</span><span style="--0:#D4D4D4;--1:#000000">(LLVM </span><span style="--0:#9CDCFE;--1:#001080">NovaGenSubtargetInfo</span><span style="--0:#D4D4D4;--1:#000000">.</span><span style="--0:#9CDCFE;--1:#001080">inc</span><span style="--0:#D4D4D4;--1:#000000"> -gen-subtarget)</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#DCDCAA;--1:#775d25">tablegen</span><span style="--0:#D4D4D4;--1:#000000">(LLVM </span><span style="--0:#9CDCFE;--1:#001080">NovaGenInstrInfo</span><span style="--0:#D4D4D4;--1:#000000">.</span><span style="--0:#9CDCFE;--1:#001080">inc</span><span style="--0:#D4D4D4;--1:#000000"> -gen-instr-info)</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#DCDCAA;--1:#775d25">tablegen</span><span style="--0:#D4D4D4;--1:#000000">(LLVM </span><span style="--0:#9CDCFE;--1:#001080">NovaGenDAGISel</span><span style="--0:#D4D4D4;--1:#000000">.</span><span style="--0:#9CDCFE;--1:#001080">inc</span><span style="--0:#D4D4D4;--1:#000000"> -gen-dag-isel)</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#DCDCAA;--1:#775d25">add_public_tablegen_target</span><span style="--0:#D4D4D4;--1:#000000">(NovaCommonTableGen)</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="add_llvm_component_group(Nova)set(LLVM_TARGET_DEFINITIONS Nova.td)tablegen(LLVM NovaGenRegisterInfo.inc -gen-register-info)tablegen(LLVM NovaGenSubtargetInfo.inc -gen-subtarget)tablegen(LLVM NovaGenInstrInfo.inc -gen-instr-info)tablegen(LLVM NovaGenDAGISel.inc -gen-dag-isel)add_public_tablegen_target(NovaCommonTableGen)"><div></div></button></div></figure></div> </div>
<h2 id="adding-the-novaregisterinfo-class">Adding the NovaRegisterInfo class</h2>
<p>First, add the <code dir="auto">NovaGenRegisterInfo</code> class declaration.</p>
<div class="code-snippet astro-xvlhowr4"> <!-- for the after context div -->  <!-- for other contexts --> <div class="context astro-xvlhowr4"> <span class="astro-xvlhowr4">&gt;&gt; new file</span><br class="astro-xvlhowr4"></div> <div class="expressive-code astro-xvlhowr4"><figure class="frame has-title not-content"><figcaption class="header"><span class="title">llvm/lib/Target/Nova/NovaRegisterInfo.h(reg-info1)</span></figcaption><pre data-language="cpp" class="wrap" style="--ecMaxLine:75ch"><code><div class="ec-line highlight ins"><div class="code"><span style="--0:#80a86f;--1:#007000">///// NovaRegisterInfo.h</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#80a86f;--1:#007000">//// This contains the Nova implementation of the TargetRegisterInfo class.</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#c689c1;--1:#a100cb">#ifndef</span><span style="--0:#62a3d9;--1:#0000FF"> LLVM_LIB_TARGET_NOVA_NOVAREGISTERINFO_H</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#c689c1;--1:#a100cb">#define</span><span style="--0:#62a3d9;--1:#0000FF"> LLVM_LIB_TARGET_NOVA_NOVAREGISTERINFO_H</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#c689c1;--1:#a100cb">#include</span><span style="--0:#62a3d9;--1:#0000FF"> </span><span style="--0:#CE9178;--1:#A31515">"llvm/CodeGen/TargetRegisterInfo.h"</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#c689c1;--1:#a100cb">#define</span><span style="--0:#62a3d9;--1:#0000FF"> GET_REGINFO_HEADER</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#c689c1;--1:#a100cb">#include</span><span style="--0:#62a3d9;--1:#0000FF"> </span><span style="--0:#CE9178;--1:#A31515">"NovaGenRegisterInfo.inc"</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#80a86f;--1:#007000">// This includes the following:</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#80a86f;--1:#007000">// #include "llvm/CodeGen/TargetRegisterInfo.h"</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#80a86f;--1:#007000">//</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#80a86f;--1:#007000">// struct NovaGenRegisterInfo : public TargetRegisterInfo;</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#80a86f;--1:#007000">// namespace Nova { // Register classes</span></div></div><div class="ec-line highlight ins" style="--ecIndent:2ch"><div class="code"><span style="--0:#80a86f;--1:#007000"><span class="indent">  </span>// extern const TargetRegisterClass GPR32RegClass;</span></div></div><div class="ec-line highlight ins" style="--ecIndent:2ch"><div class="code"><span style="--0:#80a86f;--1:#007000"><span class="indent">  </span>// ... and others</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#80a86f;--1:#007000">// }</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="///// NovaRegisterInfo.h//// This contains the Nova implementation of the TargetRegisterInfo class.#ifndef LLVM_LIB_TARGET_NOVA_NOVAREGISTERINFO_H#define LLVM_LIB_TARGET_NOVA_NOVAREGISTERINFO_H#include &#x22;llvm/CodeGen/TargetRegisterInfo.h&#x22;#define GET_REGINFO_HEADER#include &#x22;NovaGenRegisterInfo.inc&#x22;// This includes the following:// #include &#x22;llvm/CodeGen/TargetRegisterInfo.h&#x22;//// struct NovaGenRegisterInfo : public TargetRegisterInfo;// namespace Nova { // Register classes  // extern const TargetRegisterClass GPR32RegClass;  // ... and others// }"><div></div></button></div></figure></div> </div>
<p>Remember to add this to CMakelists.txt as well.</p>
<div class="code-snippet astro-xvlhowr4"> <!-- for the after context div -->  <!-- for other contexts -->  <div class="expressive-code astro-xvlhowr4"><figure class="frame has-title not-content"><figcaption class="header"><span class="title">llvm/lib/Target/Nova/CMakeLists.txt(cmake-reg-info-cpp)</span></figcaption><pre data-language="cpp" class="wrap" style="--ecMaxLine:27ch"><code><div class="ec-line"><div class="code"><span style="--0:#DCDCAA;--1:#795E26">add_llvm_target</span><span style="--0:#D4D4D4;--1:#000000">(NovaCodeGen</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="code"><span class="indent">  </span><span style="--0:#9CDCFE;--1:#001080">NovaTargetMachine</span><span style="--0:#D4D4D4;--1:#000000">.</span><span style="--0:#9CDCFE;--1:#001080">cpp</span></div></div><div class="ec-line highlight ins" style="--ecIndent:2ch"><div class="code"><span class="indent">  </span><span style="--0:#9CDCFE;--1:#001080">NovaRegisterInfo</span><span style="--0:#D4D4D4;--1:#000000">.</span><span style="--0:#9CDCFE;--1:#001080">cpp</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="add_llvm_target(NovaCodeGen  NovaTargetMachine.cpp  NovaRegisterInfo.cpp"><div></div></button></div></figure></div> </div>
<p>Add the <code dir="auto">NovaRegisterInfo</code> class.</p>
<div class="code-snippet astro-xvlhowr4"> <!-- for the after context div -->  <!-- for other contexts -->  <div class="expressive-code astro-xvlhowr4"><figure class="frame has-title not-content"><figcaption class="header"><span class="title">llvm/lib/Target/Nova/NovaRegisterInfo.h(reg-info2)</span></figcaption><pre data-language="cpp" class="wrap" style="--ecMaxLine:80ch"><code><div class="ec-line" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#74A061;--1:#007A00">  </span></span><span style="--0:#74A061;--1:#007A00">// ... and others</span></div></div><div class="ec-line"><div class="code"><span style="--0:#74A061;--1:#007A00">// }</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#62a3d9;--1:#0000FF">namespace</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#4EC9B0;--1:#1f687d">llvm</span><span style="--0:#D4D4D4;--1:#000000"> {</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#62a3d9;--1:#0000FF">class</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#4EC9B0;--1:#1f687d">NovaRegisterInfo</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#62a3d9;--1:#0000FF">final</span><span style="--0:#D4D4D4;--1:#000000"> : </span><span style="--0:#62a3d9;--1:#0000FF">public</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#4EC9B0;--1:#1f687d">NovaGenRegisterInfo</span><span style="--0:#D4D4D4;--1:#000000"> {</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#62a3d9;--1:#0000FF">public:</span></div></div><div class="ec-line highlight ins" style="--ecIndent:2ch"><div class="code"><span class="indent">  </span><span style="--0:#DCDCAA;--1:#775d25">NovaRegisterInfo</span><span style="--0:#D4D4D4;--1:#000000">();</span></div></div><div class="ec-line highlight ins" style="--ecIndent:2ch"><div class="code"><span class="indent">  </span><span style="--0:#62a3d9;--1:#0000FF">const</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#4EC9B0;--1:#1f687d">MCPhysReg</span><span style="--0:#62a3d9;--1:#0000FF">*</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#DCDCAA;--1:#775d25">getCalleeSavedRegs</span><span style="--0:#D4D4D4;--1:#000000">(</span><span style="--0:#62a3d9;--1:#0000FF">const</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#4EC9B0;--1:#1f687d">MachineFunction</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#62a3d9;--1:#0000FF">*</span><span style="--0:#9CDCFE;--1:#001080">MF</span><span style="--0:#D4D4D4;--1:#000000">) </span><span style="--0:#62a3d9;--1:#0000FF">const</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#62a3d9;--1:#0000FF">override</span><span style="--0:#D4D4D4;--1:#000000">;</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins" style="--ecIndent:2ch"><div class="code"><span class="indent">  </span><span style="--0:#4EC9B0;--1:#1f687d">BitVector</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#DCDCAA;--1:#775d25">getReservedRegs</span><span style="--0:#D4D4D4;--1:#000000">(</span><span style="--0:#62a3d9;--1:#0000FF">const</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#4EC9B0;--1:#1f687d">MachineFunction</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#62a3d9;--1:#0000FF">&#x26;</span><span style="--0:#9CDCFE;--1:#001080">MF</span><span style="--0:#D4D4D4;--1:#000000">) </span><span style="--0:#62a3d9;--1:#0000FF">const</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#62a3d9;--1:#0000FF">override</span><span style="--0:#D4D4D4;--1:#000000">;</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins" style="--ecIndent:2ch"><div class="code"><span class="indent">  </span><span style="--0:#62a3d9;--1:#0000FF">bool</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#DCDCAA;--1:#775d25">eliminateFrameIndex</span><span style="--0:#D4D4D4;--1:#000000">(</span><span style="--0:#4EC9B0;--1:#1f687d">MachineBasicBlock</span><span style="--0:#D4D4D4;--1:#000000">::</span><span style="--0:#4EC9B0;--1:#1f687d">iterator</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#9CDCFE;--1:#001080">II</span><span style="--0:#D4D4D4;--1:#000000">,</span></div></div><div class="ec-line highlight ins" style="--ecIndent:28ch"><div class="code"><span class="indent">                            </span><span style="--0:#62a3d9;--1:#0000FF">int</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#9CDCFE;--1:#001080">SPAdj</span><span style="--0:#D4D4D4;--1:#000000">, </span><span style="--0:#62a3d9;--1:#0000FF">unsigned</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#9CDCFE;--1:#001080">FIOperandNum</span><span style="--0:#D4D4D4;--1:#000000">,</span></div></div><div class="ec-line highlight ins" style="--ecIndent:28ch"><div class="code"><span class="indent">                            </span><span style="--0:#4EC9B0;--1:#1f687d">RegScavenger</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#62a3d9;--1:#0000FF">*</span><span style="--0:#9CDCFE;--1:#001080">RS</span><span style="--0:#D4D4D4;--1:#000000"> = </span><span style="--0:#62a3d9;--1:#0000FF">nullptr</span><span style="--0:#D4D4D4;--1:#000000">) </span><span style="--0:#62a3d9;--1:#0000FF">const</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#62a3d9;--1:#0000FF">override</span><span style="--0:#D4D4D4;--1:#000000">;</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins" style="--ecIndent:2ch"><div class="code"><span class="indent">  </span><span style="--0:#4EC9B0;--1:#1f687d">Register</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#DCDCAA;--1:#775d25">getFrameRegister</span><span style="--0:#D4D4D4;--1:#000000">(</span><span style="--0:#62a3d9;--1:#0000FF">const</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#4EC9B0;--1:#1f687d">MachineFunction</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#62a3d9;--1:#0000FF">&#x26;</span><span style="--0:#9CDCFE;--1:#001080">MF</span><span style="--0:#D4D4D4;--1:#000000">) </span><span style="--0:#62a3d9;--1:#0000FF">const</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#62a3d9;--1:#0000FF">override</span><span style="--0:#D4D4D4;--1:#000000">;</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#D4D4D4;--1:#000000">};</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#D4D4D4;--1:#000000">}</span><span style="--0:#80a86f;--1:#007000"> // end namespace llvm</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#c689c1;--1:#a100cb">#endif</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="  // ... and others// }namespace llvm {class NovaRegisterInfo final : public NovaGenRegisterInfo {public:  NovaRegisterInfo();  const MCPhysReg* getCalleeSavedRegs(const MachineFunction *MF) const override;  BitVector getReservedRegs(const MachineFunction &#x26;MF) const override;  bool eliminateFrameIndex(MachineBasicBlock::iterator II,                            int SPAdj, unsigned FIOperandNum,                            RegScavenger *RS = nullptr) const override;  Register getFrameRegister(const MachineFunction &#x26;MF) const override;};} // end namespace llvm#endif"><div></div></button></div></figure></div> </div>
<p>Revisit this later when we start to lower call and return instructions.</p>
<p>Now we register our RegisterInfo class with our target.</p>
<p>First, remove stand-in method we added earlier and move
it to a new file <code dir="auto">NovaMCTargetDesc.cpp</code>. This file contains
all the target description classes for registers
instructions.</p>
<div class="code-snippet astro-xvlhowr4"> <!-- for the after context div -->  <!-- for other contexts -->  <div class="expressive-code astro-xvlhowr4"><figure class="frame has-title not-content"><figcaption class="header"><span class="title">llvm/lib/Target/Nova/NovaTargetMachine.cpp(deleted-mc-init)</span></figcaption><pre data-language="cpp" class="wrap" style="--ecMaxLine:46ch"><code><div class="ec-line highlight del"><div class="code"><span style="--0:#61a3d9;--1:#0000FF">extern</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#CE9178;--1:#A31515">"C"</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#61a3d9;--1:#0000FF">void</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#DCDCAA;--1:#765c25">LLVMInitializeNovaTargetMC</span><span style="--0:#D4D4D4;--1:#000000">() {</span></div></div><div class="ec-line highlight del" style="--ecIndent:4ch"><div class="code"><span style="--0:#80a86f;--1:#007000"><span class="indent">    </span>// TODO: Add initialize target MC</span></div></div><div class="ec-line highlight del"><div class="code"><span style="--0:#D4D4D4;--1:#000000">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="extern &#x22;C&#x22; void LLVMInitializeNovaTargetMC() {    // TODO: Add initialize target MC}"><div></div></button></div></figure></div> </div>
<div class="code-snippet astro-xvlhowr4"> <!-- for the after context div -->  <!-- for other contexts --> <div class="context astro-xvlhowr4"> <span class="astro-xvlhowr4">&gt;&gt; new file</span><br class="astro-xvlhowr4"></div> <div class="expressive-code astro-xvlhowr4"><figure class="frame has-title not-content"><figcaption class="header"><span class="title">llvm/lib/Target/Nova/NovaMCTargetDesc.h(nova-mc-tdesc-1)</span></figcaption><pre data-language="cpp" class="wrap" style="--ecMaxLine:63ch"><code><div class="ec-line highlight ins"><div class="code"><span style="--0:#80a86f;--1:#007000">/// This file provides Nova-specific target descriptions.</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#c689c1;--1:#a100cb">#ifndef</span><span style="--0:#62a3d9;--1:#0000FF"> LLVM_LIB_TARGET_NOVA_MCTARGETDESC_H</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#c689c1;--1:#a100cb">#define</span><span style="--0:#62a3d9;--1:#0000FF"> LLVM_LIB_TARGET_NOVA_MCTARGETDESC_H</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#80a86f;--1:#007000">// Include symbolic names for registers. This includes the enum</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#80a86f;--1:#007000">// for register to register number mapping. (Nova::RA etc) and</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#80a86f;--1:#007000">// the register classes.</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#c689c1;--1:#a100cb">#define</span><span style="--0:#62a3d9;--1:#0000FF"> GET_REGINFO_ENUM</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#c689c1;--1:#a100cb">#include</span><span style="--0:#62a3d9;--1:#0000FF"> </span><span style="--0:#CE9178;--1:#A31515">"NovaGenRegisterInfo.inc"</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#c689c1;--1:#a100cb">#define</span><span style="--0:#62a3d9;--1:#0000FF"> GET_INSTRINFO_ENUM</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#c689c1;--1:#a100cb">#include</span><span style="--0:#62a3d9;--1:#0000FF"> </span><span style="--0:#CE9178;--1:#A31515">"NovaGenInstrInfo.inc"</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#c689c1;--1:#a100cb">#define</span><span style="--0:#62a3d9;--1:#0000FF"> GET_SUBTARGETINFO_ENUM</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#c689c1;--1:#a100cb">#include</span><span style="--0:#62a3d9;--1:#0000FF"> </span><span style="--0:#CE9178;--1:#A31515">"NovaGenSubtargetInfo.inc"</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#c689c1;--1:#a100cb">#endif</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="/// This file provides Nova-specific target descriptions.#ifndef LLVM_LIB_TARGET_NOVA_MCTARGETDESC_H#define LLVM_LIB_TARGET_NOVA_MCTARGETDESC_H// Include symbolic names for registers. This includes the enum// for register to register number mapping. (Nova::RA etc) and// the register classes.#define GET_REGINFO_ENUM#include &#x22;NovaGenRegisterInfo.inc&#x22;#define GET_INSTRINFO_ENUM#include &#x22;NovaGenInstrInfo.inc&#x22;#define GET_SUBTARGETINFO_ENUM#include &#x22;NovaGenSubtargetInfo.inc&#x22;#endif"><div></div></button></div></figure></div> </div>
<p>Register the Novaâ€™s <code dir="auto">MCRegisterInfo</code> class instance in its corresponding
implementation file.</p>
<div class="code-snippet astro-xvlhowr4"> <!-- for the after context div -->  <!-- for other contexts --> <div class="context astro-xvlhowr4"> <span class="astro-xvlhowr4">&gt;&gt; new file</span><br class="astro-xvlhowr4"></div> <div class="expressive-code astro-xvlhowr4"><figure class="frame has-title not-content"><figcaption class="header"><span class="title">llvm/lib/Target/Nova/NovaMCTargetDesc.cpp(create-reginfo)</span></figcaption><pre data-language="cpp" class="wrap" style="--ecMaxLine:116ch"><code><div class="ec-line highlight ins"><div class="code"><span style="--0:#c689c1;--1:#a100cb">#include</span><span style="--0:#62a3d9;--1:#0000FF"> </span><span style="--0:#CE9178;--1:#A31515">"NovaMCTargetDesc.h"</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#c689c1;--1:#a100cb">#include</span><span style="--0:#62a3d9;--1:#0000FF"> </span><span style="--0:#CE9178;--1:#A31515">"MCTargetDesc/NovaMCAsmInfo.h"</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#c689c1;--1:#a100cb">#include</span><span style="--0:#62a3d9;--1:#0000FF"> </span><span style="--0:#CE9178;--1:#A31515">"NovaTargetInfo.h"</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#c689c1;--1:#a100cb">#include</span><span style="--0:#62a3d9;--1:#0000FF"> </span><span style="--0:#CE9178;--1:#A31515">"llvm/CodeGen/MachineRegisterInfo.h"</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#c689c1;--1:#a100cb">#include</span><span style="--0:#62a3d9;--1:#0000FF"> </span><span style="--0:#CE9178;--1:#A31515">"llvm/MC/MCDwarf.h"</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#c689c1;--1:#a100cb">#include</span><span style="--0:#62a3d9;--1:#0000FF"> </span><span style="--0:#CE9178;--1:#A31515">"llvm/MC/MCInstrInfo.h"</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#c689c1;--1:#a100cb">#include</span><span style="--0:#62a3d9;--1:#0000FF"> </span><span style="--0:#CE9178;--1:#A31515">"llvm/MC/MCSubtargetInfo.h"</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#c689c1;--1:#a100cb">#include</span><span style="--0:#62a3d9;--1:#0000FF"> </span><span style="--0:#CE9178;--1:#A31515">"llvm/MC/TargetRegistry.h"</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#c689c1;--1:#a100cb">using</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#62a3d9;--1:#0000FF">namespace</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#4EC9B0;--1:#1f687d">llvm</span><span style="--0:#D4D4D4;--1:#000000">;</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#c689c1;--1:#a100cb">#define</span><span style="--0:#62a3d9;--1:#0000FF"> GET_INSTRINFO_MC_DESC</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#c689c1;--1:#a100cb">#define</span><span style="--0:#62a3d9;--1:#0000FF"> ENABLE_INSTR_PREDICATE_VERIFIER</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#c689c1;--1:#a100cb">#include</span><span style="--0:#62a3d9;--1:#0000FF"> </span><span style="--0:#CE9178;--1:#A31515">"NovaGenInstrInfo.inc"</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#c689c1;--1:#a100cb">#define</span><span style="--0:#62a3d9;--1:#0000FF"> GET_REGINFO_MC_DESC</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#c689c1;--1:#a100cb">#include</span><span style="--0:#62a3d9;--1:#0000FF"> </span><span style="--0:#CE9178;--1:#A31515">"NovaGenRegisterInfo.inc"</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#c689c1;--1:#a100cb">#define</span><span style="--0:#62a3d9;--1:#0000FF"> GET_SUBTARGETINFO_MC_DESC</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#c689c1;--1:#a100cb">#include</span><span style="--0:#62a3d9;--1:#0000FF"> </span><span style="--0:#CE9178;--1:#A31515">"NovaGenSubtargetInfo.inc"</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#62a3d9;--1:#0000FF">static</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#4EC9B0;--1:#1f687d">MCRegisterInfo</span><span style="--0:#62a3d9;--1:#0000FF">*</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#DCDCAA;--1:#775d25">createNovaMCRegisterInfo</span><span style="--0:#D4D4D4;--1:#000000">(</span><span style="--0:#62a3d9;--1:#0000FF">const</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#4EC9B0;--1:#1f687d">Triple</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#62a3d9;--1:#0000FF">&#x26;</span><span style="--0:#9CDCFE;--1:#001080">TT</span><span style="--0:#D4D4D4;--1:#000000">) {</span></div></div><div class="ec-line highlight ins" style="--ecIndent:4ch"><div class="code"><span class="indent"><span style="--0:#D4D4D4;--1:#000000">    </span></span><span style="--0:#D4D4D4;--1:#000000">MCRegisterInfo *X = </span><span style="--0:#c689c1;--1:#a100cb">new</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#DCDCAA;--1:#775d25">MCRegisterInfo</span><span style="--0:#D4D4D4;--1:#000000">();</span></div></div><div class="ec-line highlight ins" style="--ecIndent:4ch"><div class="code"><span class="indent">    </span><span style="--0:#DCDCAA;--1:#775d25">InitNovaMCRegisterInfo</span><span style="--0:#D4D4D4;--1:#000000">(X, </span><span style="--0:#4EC9B0;--1:#1f687d">Nova</span><span style="--0:#D4D4D4;--1:#000000">::RA);</span></div></div><div class="ec-line highlight ins" style="--ecIndent:4ch"><div class="code"><span class="indent">    </span><span style="--0:#c689c1;--1:#a100cb">return</span><span style="--0:#D4D4D4;--1:#000000"> X;</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#D4D4D4;--1:#000000">}</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#62a3d9;--1:#0000FF">static</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#4EC9B0;--1:#1f687d">MCInstrInfo</span><span style="--0:#62a3d9;--1:#0000FF">*</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#DCDCAA;--1:#775d25">createNovaMCInstrInfo</span><span style="--0:#D4D4D4;--1:#000000">() {</span></div></div><div class="ec-line highlight ins" style="--ecIndent:4ch"><div class="code"><span class="indent"><span style="--0:#D4D4D4;--1:#000000">    </span></span><span style="--0:#D4D4D4;--1:#000000">MCInstrInfo *X = </span><span style="--0:#c689c1;--1:#a100cb">new</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#DCDCAA;--1:#775d25">MCInstrInfo</span><span style="--0:#D4D4D4;--1:#000000">();</span></div></div><div class="ec-line highlight ins" style="--ecIndent:4ch"><div class="code"><span class="indent">    </span><span style="--0:#DCDCAA;--1:#775d25">InitNovaMCInstrInfo</span><span style="--0:#D4D4D4;--1:#000000">(X);</span></div></div><div class="ec-line highlight ins" style="--ecIndent:4ch"><div class="code"><span class="indent">    </span><span style="--0:#c689c1;--1:#a100cb">return</span><span style="--0:#D4D4D4;--1:#000000"> X;</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#D4D4D4;--1:#000000">}</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#62a3d9;--1:#0000FF">static</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#4EC9B0;--1:#1f687d">MCSubtargetInfo</span><span style="--0:#62a3d9;--1:#0000FF">*</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#DCDCAA;--1:#775d25">createNovaSubtargetInfo</span><span style="--0:#D4D4D4;--1:#000000">(</span><span style="--0:#62a3d9;--1:#0000FF">const</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#4EC9B0;--1:#1f687d">Triple</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#62a3d9;--1:#0000FF">&#x26;</span><span style="--0:#9CDCFE;--1:#001080">TT</span><span style="--0:#D4D4D4;--1:#000000">, </span><span style="--0:#4EC9B0;--1:#1f687d">StringRef</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#9CDCFE;--1:#001080">CPU</span><span style="--0:#D4D4D4;--1:#000000">, </span><span style="--0:#4EC9B0;--1:#1f687d">StringRef</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#9CDCFE;--1:#001080">FS</span><span style="--0:#D4D4D4;--1:#000000">) {</span></div></div><div class="ec-line highlight ins" style="--ecIndent:4ch"><div class="code"><span class="indent">    </span><span style="--0:#c689c1;--1:#a100cb">if</span><span style="--0:#D4D4D4;--1:#000000"> (</span><span style="--0:#9CDCFE;--1:#001080">CPU</span><span style="--0:#D4D4D4;--1:#000000">.</span><span style="--0:#DCDCAA;--1:#775d25">empty</span><span style="--0:#D4D4D4;--1:#000000">())</span></div></div><div class="ec-line highlight ins" style="--ecIndent:8ch"><div class="code"><span class="indent"><span style="--0:#D4D4D4;--1:#000000">        </span></span><span style="--0:#D4D4D4;--1:#000000">CPU = </span><span style="--0:#CE9178;--1:#A31515">"generic"</span><span style="--0:#D4D4D4;--1:#000000">;</span></div></div><div class="ec-line highlight ins" style="--ecIndent:4ch"><div class="code"><span class="indent">    </span><span style="--0:#c689c1;--1:#a100cb">return</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#DCDCAA;--1:#775d25">createNovaMCSubtargetInfoImpl</span><span style="--0:#D4D4D4;--1:#000000">(TT, CPU, CPU, FS);</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#D4D4D4;--1:#000000">}</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#62a3d9;--1:#0000FF">static</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#4EC9B0;--1:#1f687d">MCAsmInfo</span><span style="--0:#62a3d9;--1:#0000FF">*</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#DCDCAA;--1:#775d25">createNovaMCAsmInfo</span><span style="--0:#D4D4D4;--1:#000000">(</span><span style="--0:#62a3d9;--1:#0000FF">const</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#4EC9B0;--1:#1f687d">MCRegisterInfo</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#62a3d9;--1:#0000FF">&#x26;</span><span style="--0:#9CDCFE;--1:#001080">MRI</span><span style="--0:#D4D4D4;--1:#000000">, </span><span style="--0:#62a3d9;--1:#0000FF">const</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#4EC9B0;--1:#1f687d">Triple</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#62a3d9;--1:#0000FF">&#x26;</span><span style="--0:#9CDCFE;--1:#001080">TT</span><span style="--0:#D4D4D4;--1:#000000">, </span><span style="--0:#62a3d9;--1:#0000FF">const</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#4EC9B0;--1:#1f687d">MCTargetOptions</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#62a3d9;--1:#0000FF">&#x26;</span><span style="--0:#9CDCFE;--1:#001080">Options</span><span style="--0:#D4D4D4;--1:#000000">) {</span></div></div><div class="ec-line highlight ins" style="--ecIndent:4ch"><div class="code"><span class="indent"><span style="--0:#D4D4D4;--1:#000000">    </span></span><span style="--0:#D4D4D4;--1:#000000">MCAsmInfo *X = </span><span style="--0:#c689c1;--1:#a100cb">new</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#DCDCAA;--1:#775d25">NovaMCAsmInfo</span><span style="--0:#D4D4D4;--1:#000000">(TT);</span></div></div><div class="ec-line highlight ins" style="--ecIndent:4ch"><div class="code"><span class="indent">    </span><span style="--0:#62a3d9;--1:#0000FF">unsigned</span><span style="--0:#D4D4D4;--1:#000000"> SP = </span><span style="--0:#9CDCFE;--1:#001080">MRI</span><span style="--0:#D4D4D4;--1:#000000">.</span><span style="--0:#DCDCAA;--1:#775d25">getDwarfRegNum</span><span style="--0:#D4D4D4;--1:#000000">(</span><span style="--0:#4EC9B0;--1:#1f687d">Nova</span><span style="--0:#D4D4D4;--1:#000000">::SP, </span><span style="--0:#62a3d9;--1:#0000FF">true</span><span style="--0:#D4D4D4;--1:#000000">);</span></div></div><div class="ec-line highlight ins" style="--ecIndent:4ch"><div class="code"><span class="indent"><span style="--0:#D4D4D4;--1:#000000">    </span></span><span style="--0:#D4D4D4;--1:#000000">MCCFIInstruction Inst = </span><span style="--0:#4EC9B0;--1:#1f687d">MCCFIInstruction</span><span style="--0:#D4D4D4;--1:#000000">::</span><span style="--0:#DCDCAA;--1:#775d25">createDefCfaRegister</span><span style="--0:#D4D4D4;--1:#000000">(</span><span style="--0:#62a3d9;--1:#0000FF">nullptr</span><span style="--0:#D4D4D4;--1:#000000">, SP);</span></div></div><div class="ec-line highlight ins" style="--ecIndent:4ch"><div class="code"><span class="indent">    </span><span style="--0:#9CDCFE;--1:#001080">X</span><span style="--0:#D4D4D4;--1:#000000">-></span><span style="--0:#DCDCAA;--1:#775d25">addInitialFrameState</span><span style="--0:#D4D4D4;--1:#000000">(Inst);</span></div></div><div class="ec-line highlight ins" style="--ecIndent:4ch"><div class="code"><span class="indent">    </span><span style="--0:#c689c1;--1:#a100cb">return</span><span style="--0:#D4D4D4;--1:#000000"> X;</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#D4D4D4;--1:#000000">}</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#62a3d9;--1:#0000FF">extern</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#CE9178;--1:#A31515">"C"</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#62a3d9;--1:#0000FF">void</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#DCDCAA;--1:#775d25">LLVMInitializeNovaTargetMC</span><span style="--0:#D4D4D4;--1:#000000">() {</span></div></div><div class="ec-line highlight ins" style="--ecIndent:4ch"><div class="code"><span class="indent"><span style="--0:#D4D4D4;--1:#000000">    </span></span><span style="--0:#D4D4D4;--1:#000000">Target *T = &#x26;</span><span style="--0:#DCDCAA;--1:#775d25">getTheNovaTarget</span><span style="--0:#D4D4D4;--1:#000000">();</span></div></div><div class="ec-line highlight ins" style="--ecIndent:4ch"><div class="code"><span class="indent">    </span><span style="--0:#4EC9B0;--1:#1f687d">TargetRegistry</span><span style="--0:#D4D4D4;--1:#000000">::</span><span style="--0:#DCDCAA;--1:#775d25">RegisterMCRegInfo</span><span style="--0:#D4D4D4;--1:#000000">(*T, createNovaMCRegisterInfo);</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins" style="--ecIndent:4ch"><div class="code"><span class="indent">    </span><span style="--0:#4EC9B0;--1:#1f687d">TargetRegistry</span><span style="--0:#D4D4D4;--1:#000000">::</span><span style="--0:#DCDCAA;--1:#775d25">RegisterMCInstrInfo</span><span style="--0:#D4D4D4;--1:#000000">(*T, createNovaMCInstrInfo);</span></div></div><div class="ec-line highlight ins" style="--ecIndent:4ch"><div class="code"><span class="indent">    </span><span style="--0:#4EC9B0;--1:#1f687d">TargetRegistry</span><span style="--0:#D4D4D4;--1:#000000">::</span><span style="--0:#DCDCAA;--1:#775d25">RegisterMCSubtargetInfo</span><span style="--0:#D4D4D4;--1:#000000">(*T, createNovaSubtargetInfo);</span></div></div><div class="ec-line highlight ins" style="--ecIndent:4ch"><div class="code"><span class="indent">    </span><span style="--0:#4EC9B0;--1:#1f687d">TargetRegistry</span><span style="--0:#D4D4D4;--1:#000000">::</span><span style="--0:#DCDCAA;--1:#775d25">RegisterMCAsmInfo</span><span style="--0:#D4D4D4;--1:#000000">(*T, createNovaMCAsmInfo);</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#D4D4D4;--1:#000000">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="#include &#x22;NovaMCTargetDesc.h&#x22;#include &#x22;MCTargetDesc/NovaMCAsmInfo.h&#x22;#include &#x22;NovaTargetInfo.h&#x22;#include &#x22;llvm/CodeGen/MachineRegisterInfo.h&#x22;#include &#x22;llvm/MC/MCDwarf.h&#x22;#include &#x22;llvm/MC/MCInstrInfo.h&#x22;#include &#x22;llvm/MC/MCSubtargetInfo.h&#x22;#include &#x22;llvm/MC/TargetRegistry.h&#x22;using namespace llvm;#define GET_INSTRINFO_MC_DESC#define ENABLE_INSTR_PREDICATE_VERIFIER#include &#x22;NovaGenInstrInfo.inc&#x22;#define GET_REGINFO_MC_DESC#include &#x22;NovaGenRegisterInfo.inc&#x22;#define GET_SUBTARGETINFO_MC_DESC#include &#x22;NovaGenSubtargetInfo.inc&#x22;static MCRegisterInfo* createNovaMCRegisterInfo(const Triple &#x26;TT) {    MCRegisterInfo *X = new MCRegisterInfo();    InitNovaMCRegisterInfo(X, Nova::RA);    return X;}static MCInstrInfo* createNovaMCInstrInfo() {    MCInstrInfo *X = new MCInstrInfo();    InitNovaMCInstrInfo(X);    return X;}static MCSubtargetInfo* createNovaSubtargetInfo(const Triple &#x26;TT, StringRef CPU, StringRef FS) {    if (CPU.empty())        CPU = &#x22;generic&#x22;;    return createNovaMCSubtargetInfoImpl(TT, CPU, CPU, FS);}static MCAsmInfo* createNovaMCAsmInfo(const MCRegisterInfo &#x26;MRI, const Triple &#x26;TT, const MCTargetOptions &#x26;Options) {    MCAsmInfo *X = new NovaMCAsmInfo(TT);    unsigned SP = MRI.getDwarfRegNum(Nova::SP, true);    MCCFIInstruction Inst = MCCFIInstruction::createDefCfaRegister(nullptr, SP);    X->addInitialFrameState(Inst);    return X;}extern &#x22;C&#x22; void LLVMInitializeNovaTargetMC() {    Target *T = &#x26;getTheNovaTarget();    TargetRegistry::RegisterMCRegInfo(*T, createNovaMCRegisterInfo);    TargetRegistry::RegisterMCInstrInfo(*T, createNovaMCInstrInfo);    TargetRegistry::RegisterMCSubtargetInfo(*T, createNovaSubtargetInfo);    TargetRegistry::RegisterMCAsmInfo(*T, createNovaMCAsmInfo);}"><div></div></button></div></figure></div> </div>
<p>And include the file in our build.</p>
<div class="code-snippet astro-xvlhowr4"> <!-- for the after context div -->  <!-- for other contexts -->  <div class="expressive-code astro-xvlhowr4"><figure class="frame has-title not-content"><figcaption class="header"><span class="title">llvm/lib/Target/Nova/CMakeLists.txt(cmake-mc-tdesc)</span></figcaption><pre data-language="cpp" class="wrap" style="--ecMaxLine:23ch"><code><div class="ec-line" style="--ecIndent:2ch"><div class="code"><span class="indent">  </span><span style="--0:#9CDCFE;--1:#001080">NovaTargetMachine</span><span style="--0:#D4D4D4;--1:#000000">.</span><span style="--0:#9CDCFE;--1:#001080">cpp</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="code"><span class="indent">  </span><span style="--0:#9CDCFE;--1:#001080">NovaRegisterInfo</span><span style="--0:#D4D4D4;--1:#000000">.</span><span style="--0:#9CDCFE;--1:#001080">cpp</span></div></div><div class="ec-line highlight ins" style="--ecIndent:2ch"><div class="code"><span class="indent">  </span><span style="--0:#9CDCFE;--1:#001080">NovaMCTargetDesc</span><span style="--0:#D4D4D4;--1:#000000">.</span><span style="--0:#9CDCFE;--1:#001080">cpp</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="  NovaTargetMachine.cpp  NovaRegisterInfo.cpp  NovaMCTargetDesc.cpp"><div></div></button></div></figure></div> </div>
<p>Move the target getters to a new file so we can reuse them.</p>
<div class="code-snippet astro-xvlhowr4"> <!-- for the after context div -->  <!-- for other contexts -->  <div class="expressive-code astro-xvlhowr4"><figure class="frame has-title not-content"><figcaption class="header"><span class="title">llvm/lib/Target/Nova/NovaTargetMachine.cpp(nova-target-info-tm)</span></figcaption><pre data-language="cpp" class="wrap" style="--ecMaxLine:42ch"><code><div class="ec-line"><div class="code"><span style="--0:#74A061;--1:#007A00">// static Target &#x26;getTheNovaTarget() {</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#c689c1;--1:#a100cb">#include</span><span style="--0:#62a3d9;--1:#0000FF"> </span><span style="--0:#CE9178;--1:#A31515">"Nova.h"</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#c689c1;--1:#a100cb">#include</span><span style="--0:#62a3d9;--1:#0000FF"> </span><span style="--0:#CE9178;--1:#A31515">"NovaISelDAGToDAG.h"</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#c689c1;--1:#a100cb">#include</span><span style="--0:#62a3d9;--1:#0000FF"> </span><span style="--0:#CE9178;--1:#A31515">"NovaTargetInfo.h"</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C586C0;--1:#AC00D8">#include</span><span style="--0:#569CD6;--1:#0000FF"> </span><span style="--0:#CE9178;--1:#A31515">"NovaTargetMachine.h"</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C586C0;--1:#AC00D8">#include</span><span style="--0:#569CD6;--1:#0000FF"> </span><span style="--0:#CE9178;--1:#A31515">"llvm/CodeGen/TargetPassConfig.h"</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="// static Target &#x26;getTheNovaTarget() {#include &#x22;Nova.h&#x22;#include &#x22;NovaISelDAGToDAG.h&#x22;#include &#x22;NovaTargetInfo.h&#x22;#include &#x22;NovaTargetMachine.h&#x22;#include &#x22;llvm/CodeGen/TargetPassConfig.h&#x22;"><div></div></button></div></figure></div> </div>
<div class="code-snippet astro-xvlhowr4"> <!-- for the after context div -->  <!-- for other contexts --> <div class="context astro-xvlhowr4"> <span class="astro-xvlhowr4">&gt;&gt; new file</span><br class="astro-xvlhowr4"></div> <div class="expressive-code astro-xvlhowr4"><figure class="frame has-title not-content"><figcaption class="header"><span class="title">llvm/lib/Target/Nova/NovaTargetInfo.h(nova-target-info)</span></figcaption><pre data-language="cpp" class="wrap" style="--ecMaxLine:41ch"><code><div class="ec-line highlight ins"><div class="code"><span style="--0:#c689c1;--1:#a100cb">#ifndef</span><span style="--0:#62a3d9;--1:#0000FF"> LLVM_LIB_TARGET_NOVA_TARGETINFO_H</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#c689c1;--1:#a100cb">#define</span><span style="--0:#62a3d9;--1:#0000FF"> LLVM_LIB_TARGET_NOVA_TARGETINFO_H</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#62a3d9;--1:#0000FF">namespace</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#4EC9B0;--1:#1f687d">llvm</span><span style="--0:#D4D4D4;--1:#000000"> {</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#62a3d9;--1:#0000FF">class</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#4EC9B0;--1:#1f687d">Target</span><span style="--0:#D4D4D4;--1:#000000">;</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#4EC9B0;--1:#1f687d">Target</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#62a3d9;--1:#0000FF">&#x26;</span><span style="--0:#DCDCAA;--1:#775d25">getTheNovaTarget</span><span style="--0:#D4D4D4;--1:#000000">();</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#D4D4D4;--1:#000000">}</span><span style="--0:#80a86f;--1:#007000"> // namespace llvm</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#c689c1;--1:#a100cb">#endif</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="#ifndef LLVM_LIB_TARGET_NOVA_TARGETINFO_H#define LLVM_LIB_TARGET_NOVA_TARGETINFO_Hnamespace llvm {class Target;Target &#x26;getTheNovaTarget();} // namespace llvm#endif"><div></div></button></div></figure></div> </div>
<p>Fix our definition written earlier:</p>
<div class="code-snippet astro-xvlhowr4"> <!-- for the after context div -->  <!-- for other contexts -->  <div class="expressive-code astro-xvlhowr4"><figure class="frame has-title not-content"><figcaption class="header"><span class="title">llvm/lib/Target/Nova/NovaTargetMachine.cpp(new-get-the-nova)</span></figcaption><pre data-language="cpp" class="wrap" style="--ecMaxLine:35ch"><code><div class="ec-line"><div class="code"><span style="--0:#C586C0;--1:#AC00D8">using</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#569CD6;--1:#0000FF">namespace</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#4EC9B0;--1:#227188">llvm</span><span style="--0:#D4D4D4;--1:#000000">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line highlight del"><div class="code"><span style="--0:#61a3d9;--1:#0000FF">static</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#4EC9B0;--1:#1f687d">Target</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#61a3d9;--1:#0000FF">&#x26;</span><span style="--0:#DCDCAA;--1:#765c25">getTheNovaTarget</span><span style="--0:#D4D4D4;--1:#000000">() {</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#D4D4D4;--1:#000000">Target &#x26;</span><span style="--0:#4EC9B0;--1:#1f687d">llvm</span><span style="--0:#D4D4D4;--1:#000000">::</span><span style="--0:#DCDCAA;--1:#775d25">getTheNovaTarget</span><span style="--0:#D4D4D4;--1:#000000">() {</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent">    </span><span style="--0:#569CD6;--1:#0000FF">static</span><span style="--0:#D4D4D4;--1:#000000"> Target TheNovaTarget;</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent">    </span><span style="--0:#C586C0;--1:#AC00D8">return</span><span style="--0:#D4D4D4;--1:#000000"> TheNovaTarget;</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="using namespace llvm;static Target &#x26;getTheNovaTarget() {Target &#x26;llvm::getTheNovaTarget() {    static Target TheNovaTarget;    return TheNovaTarget;"><div></div></button></div></figure></div> </div>
<div class="code-snippet astro-xvlhowr4"> <!-- for the after context div -->  <!-- for other contexts --> <div class="context astro-xvlhowr4"> <span class="astro-xvlhowr4">&gt;&gt; new file</span><br class="astro-xvlhowr4"></div> <div class="expressive-code astro-xvlhowr4"><figure class="frame has-title not-content"><figcaption class="header"><span class="title">llvm/lib/Target/Nova/NovaRegisterInfo.cpp(reginfo-cpp1)</span></figcaption><pre data-language="cpp" class="wrap" style="--ecMaxLine:78ch"><code><div class="ec-line highlight ins"><div class="code"><span style="--0:#c689c1;--1:#a100cb">#include</span><span style="--0:#62a3d9;--1:#0000FF"> </span><span style="--0:#CE9178;--1:#A31515">"NovaRegisterInfo.h"</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#c689c1;--1:#a100cb">#include</span><span style="--0:#62a3d9;--1:#0000FF"> </span><span style="--0:#CE9178;--1:#A31515">"NovaFrameLowering.h"</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#c689c1;--1:#a100cb">#include</span><span style="--0:#62a3d9;--1:#0000FF"> </span><span style="--0:#CE9178;--1:#A31515">"NovaMCTargetDesc.h"</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#c689c1;--1:#a100cb">#include</span><span style="--0:#62a3d9;--1:#0000FF"> </span><span style="--0:#CE9178;--1:#A31515">"llvm/CodeGen/MachineFunction.h"</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#c689c1;--1:#a100cb">#include</span><span style="--0:#62a3d9;--1:#0000FF"> </span><span style="--0:#CE9178;--1:#A31515">"llvm/CodeGen/TargetSubtargetInfo.h"</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#c689c1;--1:#a100cb">#include</span><span style="--0:#62a3d9;--1:#0000FF"> </span><span style="--0:#CE9178;--1:#A31515">"llvm/MC/MCRegister.h"</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#c689c1;--1:#a100cb">using</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#62a3d9;--1:#0000FF">namespace</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#4EC9B0;--1:#1f687d">llvm</span><span style="--0:#D4D4D4;--1:#000000">;</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#c689c1;--1:#a100cb">#define</span><span style="--0:#62a3d9;--1:#0000FF"> DEBUG_TYPE </span><span style="--0:#CE9178;--1:#A31515">"nova-reg-info"</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#c689c1;--1:#a100cb">#define</span><span style="--0:#62a3d9;--1:#0000FF"> GET_REGINFO_TARGET_DESC</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#c689c1;--1:#a100cb">#include</span><span style="--0:#62a3d9;--1:#0000FF"> </span><span style="--0:#CE9178;--1:#A31515">"NovaGenRegisterInfo.inc"</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#c689c1;--1:#a100cb">using</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#62a3d9;--1:#0000FF">namespace</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#4EC9B0;--1:#1f687d">llvm</span><span style="--0:#D4D4D4;--1:#000000">;</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#4EC9B0;--1:#1f687d">NovaRegisterInfo</span><span style="--0:#D4D4D4;--1:#000000">::</span><span style="--0:#DCDCAA;--1:#775d25">NovaRegisterInfo</span><span style="--0:#D4D4D4;--1:#000000">() : </span><span style="--0:#DCDCAA;--1:#775d25">NovaGenRegisterInfo</span><span style="--0:#D4D4D4;--1:#000000">(</span><span style="--0:#4EC9B0;--1:#1f687d">Nova</span><span style="--0:#D4D4D4;--1:#000000">::RA) {}</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#62a3d9;--1:#0000FF">const</span><span style="--0:#D4D4D4;--1:#000000"> MCPhysReg *</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#4EC9B0;--1:#1f687d">NovaRegisterInfo</span><span style="--0:#D4D4D4;--1:#000000">::</span><span style="--0:#DCDCAA;--1:#775d25">getCalleeSavedRegs</span><span style="--0:#D4D4D4;--1:#000000">(</span><span style="--0:#62a3d9;--1:#0000FF">const</span><span style="--0:#D4D4D4;--1:#000000"> MachineFunction *MF) </span><span style="--0:#62a3d9;--1:#0000FF">const</span><span style="--0:#D4D4D4;--1:#000000"> {</span></div></div><div class="ec-line highlight ins" style="--ecIndent:2ch"><div class="code"><span class="indent">  </span><span style="--0:#62a3d9;--1:#0000FF">static</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#62a3d9;--1:#0000FF">const</span><span style="--0:#D4D4D4;--1:#000000"> MCPhysReg CSRList[] = {</span></div></div><div class="ec-line highlight ins" style="--ecIndent:6ch"><div class="code"><span class="indent">      </span><span style="--0:#4EC9B0;--1:#1f687d">Nova</span><span style="--0:#D4D4D4;--1:#000000">::SP,</span><span style="--0:#80a86f;--1:#007000"> // Stack Pointer</span></div></div><div class="ec-line highlight ins" style="--ecIndent:6ch"><div class="code"><span class="indent">      </span><span style="--0:#4EC9B0;--1:#1f687d">Nova</span><span style="--0:#D4D4D4;--1:#000000">::FP,</span><span style="--0:#80a86f;--1:#007000"> // Frame Pointer</span></div></div><div class="ec-line highlight ins" style="--ecIndent:6ch"><div class="code"><span class="indent">      </span><span style="--0:#4EC9B0;--1:#1f687d">Nova</span><span style="--0:#D4D4D4;--1:#000000">::S0,</span><span style="--0:#80a86f;--1:#007000"> // R0</span></div></div><div class="ec-line highlight ins" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#D4D4D4;--1:#000000">  </span></span><span style="--0:#D4D4D4;--1:#000000">};</span></div></div><div class="ec-line highlight ins" style="--ecIndent:2ch"><div class="code"><span class="indent">  </span><span style="--0:#c689c1;--1:#a100cb">return</span><span style="--0:#D4D4D4;--1:#000000"> CSRList;</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#D4D4D4;--1:#000000">}</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#4EC9B0;--1:#1f687d">BitVector</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#4EC9B0;--1:#1f687d">NovaRegisterInfo</span><span style="--0:#D4D4D4;--1:#000000">::</span><span style="--0:#DCDCAA;--1:#775d25">getReservedRegs</span><span style="--0:#D4D4D4;--1:#000000">(</span><span style="--0:#62a3d9;--1:#0000FF">const</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#4EC9B0;--1:#1f687d">MachineFunction</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#62a3d9;--1:#0000FF">&#x26;</span><span style="--0:#9CDCFE;--1:#001080">MF</span><span style="--0:#D4D4D4;--1:#000000">) </span><span style="--0:#62a3d9;--1:#0000FF">const</span><span style="--0:#D4D4D4;--1:#000000"> {</span></div></div><div class="ec-line highlight ins" style="--ecIndent:2ch"><div class="code"><span class="indent">  </span><span style="--0:#c689c1;--1:#a100cb">return</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#DCDCAA;--1:#775d25">BitVector</span><span style="--0:#D4D4D4;--1:#000000">();</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#D4D4D4;--1:#000000">}</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#62a3d9;--1:#0000FF">bool</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#4EC9B0;--1:#1f687d">NovaRegisterInfo</span><span style="--0:#D4D4D4;--1:#000000">::</span><span style="--0:#DCDCAA;--1:#775d25">eliminateFrameIndex</span><span style="--0:#D4D4D4;--1:#000000">(</span><span style="--0:#4EC9B0;--1:#1f687d">MachineBasicBlock</span><span style="--0:#D4D4D4;--1:#000000">::</span><span style="--0:#4EC9B0;--1:#1f687d">iterator</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#9CDCFE;--1:#001080">II</span><span style="--0:#D4D4D4;--1:#000000">,</span></div></div><div class="ec-line highlight ins" style="--ecIndent:43ch"><div class="code"><span class="indent">                                           </span><span style="--0:#62a3d9;--1:#0000FF">int</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#9CDCFE;--1:#001080">SPAdj</span><span style="--0:#D4D4D4;--1:#000000">, </span><span style="--0:#62a3d9;--1:#0000FF">unsigned</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#9CDCFE;--1:#001080">FIOperandNum</span><span style="--0:#D4D4D4;--1:#000000">,</span></div></div><div class="ec-line highlight ins" style="--ecIndent:43ch"><div class="code"><span class="indent">                                           </span><span style="--0:#4EC9B0;--1:#1f687d">RegScavenger</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#62a3d9;--1:#0000FF">*</span><span style="--0:#9CDCFE;--1:#001080">RS</span><span style="--0:#D4D4D4;--1:#000000">) </span><span style="--0:#62a3d9;--1:#0000FF">const</span><span style="--0:#D4D4D4;--1:#000000"> {</span></div></div><div class="ec-line highlight ins" style="--ecIndent:44ch"><div class="code"><span class="indent">                                            </span><span style="--0:#c689c1;--1:#a100cb">return</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#62a3d9;--1:#0000FF">true</span><span style="--0:#D4D4D4;--1:#000000">;</span></div></div><div class="ec-line highlight ins" style="--ecIndent:43ch"><div class="code"><span class="indent"><span style="--0:#D4D4D4;--1:#000000">                                           </span></span><span style="--0:#D4D4D4;--1:#000000">}</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#4EC9B0;--1:#1f687d">Register</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#4EC9B0;--1:#1f687d">NovaRegisterInfo</span><span style="--0:#D4D4D4;--1:#000000">::</span><span style="--0:#DCDCAA;--1:#775d25">getFrameRegister</span><span style="--0:#D4D4D4;--1:#000000">(</span><span style="--0:#62a3d9;--1:#0000FF">const</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#4EC9B0;--1:#1f687d">MachineFunction</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#62a3d9;--1:#0000FF">&#x26;</span><span style="--0:#9CDCFE;--1:#001080">MF</span><span style="--0:#D4D4D4;--1:#000000">) </span><span style="--0:#62a3d9;--1:#0000FF">const</span><span style="--0:#D4D4D4;--1:#000000"> {</span></div></div><div class="ec-line highlight ins" style="--ecIndent:2ch"><div class="code"><span class="indent">  </span><span style="--0:#c689c1;--1:#a100cb">return</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#4EC9B0;--1:#1f687d">Nova</span><span style="--0:#D4D4D4;--1:#000000">::FP;</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#D4D4D4;--1:#000000">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="#include &#x22;NovaRegisterInfo.h&#x22;#include &#x22;NovaFrameLowering.h&#x22;#include &#x22;NovaMCTargetDesc.h&#x22;#include &#x22;llvm/CodeGen/MachineFunction.h&#x22;#include &#x22;llvm/CodeGen/TargetSubtargetInfo.h&#x22;#include &#x22;llvm/MC/MCRegister.h&#x22;using namespace llvm;#define DEBUG_TYPE &#x22;nova-reg-info&#x22;#define GET_REGINFO_TARGET_DESC#include &#x22;NovaGenRegisterInfo.inc&#x22;using namespace llvm;NovaRegisterInfo::NovaRegisterInfo() : NovaGenRegisterInfo(Nova::RA) {}const MCPhysReg *NovaRegisterInfo::getCalleeSavedRegs(const MachineFunction *MF) const {  static const MCPhysReg CSRList[] = {      Nova::SP, // Stack Pointer      Nova::FP, // Frame Pointer      Nova::S0, // R0  };  return CSRList;}BitVector NovaRegisterInfo::getReservedRegs(const MachineFunction &#x26;MF) const {  return BitVector();}bool NovaRegisterInfo::eliminateFrameIndex(MachineBasicBlock::iterator II,                                           int SPAdj, unsigned FIOperandNum,                                           RegScavenger *RS) const {                                            return true;                                           }Register NovaRegisterInfo::getFrameRegister(const MachineFunction &#x26;MF) const {  return Nova::FP;}"><div></div></button></div></figure></div> </div>
<p>Since the <code dir="auto">NovaGenRegisterInfo</code> (which drives from <code dir="auto">TargetRegisterInfo</code>) refers to <code dir="auto">NovaFrameLowering</code>,
we need to add that class.</p>
<div class="code-snippet astro-xvlhowr4"> <!-- for the after context div -->  <!-- for other contexts --> <div class="context astro-xvlhowr4"> <span class="astro-xvlhowr4">&gt;&gt; new file</span><br class="astro-xvlhowr4"></div> <div class="expressive-code astro-xvlhowr4"><figure class="frame has-title not-content"><figcaption class="header"><span class="title">llvm/lib/Target/Nova/NovaFrameLowering.h(nova-frame-lowering-1)</span></figcaption><pre data-language="cpp" class="wrap" style="--ecMaxLine:77ch"><code><div class="ec-line highlight ins"><div class="code"><span style="--0:#80a86f;--1:#007000">//===--  ----//</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#80a86f;--1:#007000">// This file defines the frame lowering for the Nova target</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#80a86f;--1:#007000">//===---------------------------------------------------------</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#c689c1;--1:#a100cb">#ifndef</span><span style="--0:#62a3d9;--1:#0000FF"> LLVM_LIB_TARGET_NOVA_FRAMELOWERING_H</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#c689c1;--1:#a100cb">#define</span><span style="--0:#62a3d9;--1:#0000FF"> LLVM_LIB_TARGET_NOVA_FRAMELOWERING_H</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#c689c1;--1:#a100cb">#include</span><span style="--0:#62a3d9;--1:#0000FF"> </span><span style="--0:#CE9178;--1:#A31515">"llvm/CodeGen/MachineBasicBlock.h"</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#c689c1;--1:#a100cb">#include</span><span style="--0:#62a3d9;--1:#0000FF"> </span><span style="--0:#CE9178;--1:#A31515">"llvm/CodeGen/TargetFrameLowering.h"</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#c689c1;--1:#a100cb">#include</span><span style="--0:#62a3d9;--1:#0000FF"> </span><span style="--0:#CE9178;--1:#A31515">"llvm/CodeGen/TargetSubtargetInfo.h"</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#62a3d9;--1:#0000FF">namespace</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#4EC9B0;--1:#1f687d">llvm</span><span style="--0:#D4D4D4;--1:#000000"> {</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#62a3d9;--1:#0000FF">class</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#4EC9B0;--1:#1f687d">NovaFrameLowering</span><span style="--0:#D4D4D4;--1:#000000"> : </span><span style="--0:#62a3d9;--1:#0000FF">public</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#4EC9B0;--1:#1f687d">TargetFrameLowering</span><span style="--0:#D4D4D4;--1:#000000"> {</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#62a3d9;--1:#0000FF">public:</span></div></div><div class="ec-line highlight ins" style="--ecIndent:2ch"><div class="code"><span class="indent">  </span><span style="--0:#62a3d9;--1:#0000FF">explicit</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#DCDCAA;--1:#775d25">NovaFrameLowering</span><span style="--0:#D4D4D4;--1:#000000">(</span><span style="--0:#62a3d9;--1:#0000FF">const</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#4EC9B0;--1:#1f687d">TargetSubtargetInfo</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#62a3d9;--1:#0000FF">&#x26;</span><span style="--0:#9CDCFE;--1:#001080">STI</span><span style="--0:#D4D4D4;--1:#000000">, </span><span style="--0:#4EC9B0;--1:#1f687d">Align</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#9CDCFE;--1:#001080">Alignment</span><span style="--0:#D4D4D4;--1:#000000">)</span></div></div><div class="ec-line highlight ins" style="--ecIndent:6ch"><div class="code"><span class="indent"><span style="--0:#D4D4D4;--1:#000000">      </span></span><span style="--0:#D4D4D4;--1:#000000">: </span><span style="--0:#DCDCAA;--1:#775d25">TargetFrameLowering</span><span style="--0:#D4D4D4;--1:#000000">(StackGrowsDown, Alignment, </span><span style="--0:#B5CEA8;--1:#076e48">0</span><span style="--0:#D4D4D4;--1:#000000">, Alignment) {}</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins" style="--ecIndent:2ch"><div class="code"><span class="indent">  </span><span style="--0:#62a3d9;--1:#0000FF">void</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#DCDCAA;--1:#775d25">emitPrologue</span><span style="--0:#D4D4D4;--1:#000000">(</span><span style="--0:#4EC9B0;--1:#1f687d">MachineFunction</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#62a3d9;--1:#0000FF">&#x26;</span><span style="--0:#9CDCFE;--1:#001080">MF</span><span style="--0:#D4D4D4;--1:#000000">,</span></div></div><div class="ec-line highlight ins" style="--ecIndent:20ch"><div class="code"><span class="indent">                    </span><span style="--0:#4EC9B0;--1:#1f687d">MachineBasicBlock</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#62a3d9;--1:#0000FF">&#x26;</span><span style="--0:#9CDCFE;--1:#001080">MBB</span><span style="--0:#D4D4D4;--1:#000000">) </span><span style="--0:#62a3d9;--1:#0000FF">const</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#62a3d9;--1:#0000FF">override</span><span style="--0:#D4D4D4;--1:#000000"> {}</span></div></div><div class="ec-line highlight ins" style="--ecIndent:2ch"><div class="code"><span class="indent">  </span><span style="--0:#62a3d9;--1:#0000FF">void</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#DCDCAA;--1:#775d25">emitEpilogue</span><span style="--0:#D4D4D4;--1:#000000">(</span><span style="--0:#4EC9B0;--1:#1f687d">MachineFunction</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#62a3d9;--1:#0000FF">&#x26;</span><span style="--0:#9CDCFE;--1:#001080">MF</span><span style="--0:#D4D4D4;--1:#000000">,</span></div></div><div class="ec-line highlight ins" style="--ecIndent:20ch"><div class="code"><span class="indent">                    </span><span style="--0:#4EC9B0;--1:#1f687d">MachineBasicBlock</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#62a3d9;--1:#0000FF">&#x26;</span><span style="--0:#9CDCFE;--1:#001080">MBB</span><span style="--0:#D4D4D4;--1:#000000">) </span><span style="--0:#62a3d9;--1:#0000FF">const</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#62a3d9;--1:#0000FF">override</span><span style="--0:#D4D4D4;--1:#000000"> {}</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins" style="--ecIndent:2ch"><div class="code"><span class="indent">  </span><span style="--0:#62a3d9;--1:#0000FF">bool</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#DCDCAA;--1:#775d25">hasFPImpl</span><span style="--0:#D4D4D4;--1:#000000">(</span><span style="--0:#62a3d9;--1:#0000FF">const</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#4EC9B0;--1:#1f687d">MachineFunction</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#62a3d9;--1:#0000FF">&#x26;</span><span style="--0:#9CDCFE;--1:#001080">MF</span><span style="--0:#D4D4D4;--1:#000000">) </span><span style="--0:#62a3d9;--1:#0000FF">const</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#62a3d9;--1:#0000FF">override</span><span style="--0:#D4D4D4;--1:#000000"> { </span><span style="--0:#c689c1;--1:#a100cb">return</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#62a3d9;--1:#0000FF">true</span><span style="--0:#D4D4D4;--1:#000000">; }</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#D4D4D4;--1:#000000">};</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#D4D4D4;--1:#000000">}</span><span style="--0:#80a86f;--1:#007000"> // end namespace llvm</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#c689c1;--1:#a100cb">#endif</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="//===--  ----//// This file defines the frame lowering for the Nova target//===---------------------------------------------------------#ifndef LLVM_LIB_TARGET_NOVA_FRAMELOWERING_H#define LLVM_LIB_TARGET_NOVA_FRAMELOWERING_H#include &#x22;llvm/CodeGen/MachineBasicBlock.h&#x22;#include &#x22;llvm/CodeGen/TargetFrameLowering.h&#x22;#include &#x22;llvm/CodeGen/TargetSubtargetInfo.h&#x22;namespace llvm {class NovaFrameLowering : public TargetFrameLowering {public:  explicit NovaFrameLowering(const TargetSubtargetInfo &#x26;STI, Align Alignment)      : TargetFrameLowering(StackGrowsDown, Alignment, 0, Alignment) {}  void emitPrologue(MachineFunction &#x26;MF,                    MachineBasicBlock &#x26;MBB) const override {}  void emitEpilogue(MachineFunction &#x26;MF,                    MachineBasicBlock &#x26;MBB) const override {}  bool hasFPImpl(const MachineFunction &#x26;MF) const override { return true; }};} // end namespace llvm#endif"><div></div></button></div></figure></div> </div>
<p>With this, you can successfully compile llc for the <code dir="auto">Nova</code> target.</p>
<p>The <code dir="auto">build</code> folder should have the tablegenâ€™erated file for the register info.</p>
<div class="expressive-code"><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash" class="wrap" style="--ecMaxLine:42ch"><code><div class="ec-line"><div class="code"><span style="--0:#DCDCAA;--1:#795E26">cmake</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#569CD6;--1:#0000FF">--build</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#CE9178;--1:#A31515">build</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#569CD6;--1:#0000FF">--target</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#CE9178;--1:#A31515">llc</span></div></div><div class="ec-line"><div class="code"><span style="--0:#DCDCAA;--1:#795E26">find</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#CE9178;--1:#A31515">build</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#569CD6;--1:#0000FF">-name</span><span style="--0:#D4D4D4;--1:#000000"> </span><span style="--0:#CE9178;--1:#A31515">"NovaGenRegisterInfo.inc"</span></div></div></code></pre><pre class="output"><div></div><div>build/lib/Target/Nova/NovaGenRegisterInfo.inc</div></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="cmake --build build --target llcfind build -name &#x22;NovaGenRegisterInfo.inc&#x22;"><div></div></button></div></figure></div>
<p>Letâ€™s move on to add the instructions for Nova.</p> </div> <footer class="sl-flex astro-3yyafb3n"> <div class="meta sl-flex astro-3yyafb3n">   </div> <div class="pagination-links print:hidden astro-u2l5gyhi" dir="ltr"> <a href="/section-1/01-triple/" rel="prev" class="astro-u2l5gyhi"> <svg aria-hidden="true" class="astro-u2l5gyhi astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.5rem;"><path d="M17 11H9.41l3.3-3.29a1.004 1.004 0 1 0-1.42-1.42l-5 5a1 1 0 0 0-.21.33 1 1 0 0 0 0 .76 1 1 0 0 0 .21.33l5 5a1.002 1.002 0 0 0 1.639-.325 1 1 0 0 0-.219-1.095L9.41 13H17a1 1 0 0 0 0-2Z"/></svg>  <span class="astro-u2l5gyhi"> Previous <br class="astro-u2l5gyhi"> <span class="link-title astro-u2l5gyhi">The Target Triple</span> </span> </a> <a href="/section-1/03-instructions/" rel="next" class="astro-u2l5gyhi"> <svg aria-hidden="true" class="astro-u2l5gyhi astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.5rem;"><path d="M17.92 11.62a1.001 1.001 0 0 0-.21-.33l-5-5a1.003 1.003 0 1 0-1.42 1.42l3.3 3.29H7a1 1 0 0 0 0 2h7.59l-3.3 3.29a1.002 1.002 0 0 0 .325 1.639 1 1 0 0 0 1.095-.219l5-5a1 1 0 0 0 .21-.33 1 1 0 0 0 0-.76Z"/></svg>  <span class="astro-u2l5gyhi"> Next <br class="astro-u2l5gyhi"> <span class="link-title astro-u2l5gyhi">Adding instructions</span> </span> </a> </div>   </footer>  </div> </div>   </main> </div> </div>  </div> </div>  </body></html>